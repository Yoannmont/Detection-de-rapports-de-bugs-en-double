<!DOCTYPE html>
<html lang="en">
  <head>
    <title>129457 &ndash; Virtual Tree  very slow</title>

      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<link href="https://bugs.eclipse.org/bugs/data/assets/03c4bb46b12126a79867f9a9f5323634.css?1593441374" rel="stylesheet" type="text/css">



    
<script type="text/javascript" src="https://bugs.eclipse.org/bugs/data/assets/a7c2f3a028f17a9aa60f56dc9d6e732d.js?1593441374"></script>

    <script type="text/javascript">
    <!--
        YAHOO.namespace('bugzilla');
        YAHOO.util.Event.addListener = function (el, sType, fn, obj, overrideContext) {
               if ( ("onpagehide" in window || YAHOO.env.ua.gecko) && sType === "unload") { sType = "pagehide"; };
               var capture = ((sType == "focusin" || sType == "focusout") && !YAHOO.env.ua.ie) ? true : false;
               return this._addListener(el, this._getType(sType), fn, obj, overrideContext, capture);
         };
        if ( "onpagehide" in window || YAHOO.env.ua.gecko) {
            YAHOO.util.Event._simpleRemove(window, "unload", 
                                           YAHOO.util.Event._unload);
        }
        
        function unhide_language_selector() { 
            YAHOO.util.Dom.removeClass(
                'lang_links_container', 'bz_default_hidden'
            ); 
        } 
        YAHOO.util.Event.onDOMReady(unhide_language_selector);

        
        var BUGZILLA = {
            param: {
                cookiepath: '\/bugs',
                maxusermatches: 10
            },
            constant: {
                COMMENT_COLS: 80
            },
            string: {
                

                attach_desc_required:
                    "You must enter a Description for this attachment.",
                component_required:
                    "You must select a Component for this bug.",
                description_required:
                    "You must enter a Description for this bug.",
                short_desc_required:
                    "You must enter a Summary for this bug.",
                version_required:
                    "You must select a Version for this bug."
            }
              , api_token: ''
        };

    if (history && history.replaceState) {
      if(!document.location.href.match(/show_bug\.cgi/)) {
        history.replaceState( null,
                             "129457 – Virtual Tree  very slow",
                             "show_bug.cgi?id=129457" );
        document.title = "129457 – Virtual Tree  very slow";
      }
      if (document.location.href.match(/show_bug\.cgi\?.*list_id=/)) {
        var href = document.location.href;
        href = href.replace(/[\?&]+list_id=(\d+|cookie)/, '');
        history.replaceState(null, "129457 – Virtual Tree  very slow", href);
      }
    }
    YAHOO.util.Event.onDOMReady(function() {
      initDirtyFieldTracking();

    });
    // -->
    </script>
<script type="text/javascript" src="https://bugs.eclipse.org/bugs/data/assets/daf5e0fb6826e6a35280e622913f0c4a.js?1593441374"></script>

    

    
    <link rel="search" type="application/opensearchdescription+xml"
                       title="Bugzilla" href="./search_plugin.cgi">
    <link rel="shortcut icon" href="images/favicon.ico">
  </head>

  <body 
        class="bugs-eclipse-org-bugs
                 bz_bug
                 bz_status_CLOSED
                 bz_product_Platform
                 bz_component_SWT
                 bz_bug_129457 yui-skin-sam">

  <div id="header"><!-- 1.0@bugzilla.org -->





<!--  START OF SOLSTICE HEADER -->
 <link rel="stylesheet" type="text/css" href="https://www.eclipse.org/eclipse.org-common/themes/solstice/public/stylesheets/vendor/cookieconsent/cookieconsent.min.css" />
 <script src="https://www.eclipse.org/eclipse.org-common/themes/solstice/public/javascript/vendor/cookieconsent/default.min.js"></script>
 <style type="text/css">
    @import url('https://www.eclipse.org/eclipse.org-common/themes/solstice/public/stylesheets/barebone.min.css')
    </style>
    <script
      src="https://www.eclipse.org/eclipse.org-common/themes/solstice/public/javascript/barebone.min.js">
    </script><header role="banner" class="barebone-layout thin-header padding-top-5 padding-bottom-5"  id="header-wrapper">
  <div class="container-fluid reset">
    <div class="row-fluid" id="header-row">
            <div class="col-sm-8 col-md-6 col-lg-4" id="header-left">
        <div class="wrapper-logo-default"><a href="https://www.eclipse.org/"><img class="logo-eclipse-default img-responsive hidden-xs" alt="logo" src="https://bugs.eclipse.org/eclipse.org-common/themes/solstice/public/images/logo/eclipse-426x100.png"/></a></div>
      </div>            <div class="col-sm-16 col-md-18 col-lg-20" id="main-menu-wrapper">
  <div class="navbar yamm" id="main-menu">
    <div id="navbar-collapse-1" class="navbar-collapse collapse">
      <ul class="nav navbar-nav navbar-right">
        <li class="visible-thin"><a href="https://www.eclipse.org/downloads/" target="_self">Download</a></li><li><a href="https://www.eclipse.org/users/" target="_self">Getting Started</a></li><li><a href="https://www.eclipse.org/membership/" target="_self">Members</a></li><li><a href="https://www.eclipse.org/projects/" target="_self">Projects</a></li>                  <li class="dropdown visible-xs"><a href="#" data-toggle="dropdown" class="dropdown-toggle">Community <b class="caret"></b></a><ul class="dropdown-menu"><li><a href="http://marketplace.eclipse.org">Marketplace</a></li><li><a href="http://events.eclipse.org">Events</a></li><li><a href="http://www.planeteclipse.org/">Planet Eclipse</a></li><li><a href="https://www.eclipse.org/community/eclipse_newsletter/">Newsletter</a></li><li><a href="https://www.youtube.com/user/EclipseFdn">Videos</a></li></ul></li><li class="dropdown visible-xs"><a href="#" data-toggle="dropdown" class="dropdown-toggle">Participate <b class="caret"></b></a><ul class="dropdown-menu"><li><a href="https://bugs.eclipse.org/bugs/">Report a Bug</a></li><li><a href="https://www.eclipse.org/forums/">Forums</a></li><li><a href="https://www.eclipse.org/mail/">Mailing Lists</a></li><li><a href="https://wiki.eclipse.org/">Wiki</a></li><li><a href="https://wiki.eclipse.org/IRC">IRC</a></li><li><a href="https://www.eclipse.org/contribute/">How to Contribute</a></li></ul></li><li class="dropdown visible-xs"><a href="#" data-toggle="dropdown" class="dropdown-toggle">Working Groups <b class="caret"></b></a><ul class="dropdown-menu"><li><a href="http://wiki.eclipse.org/Auto_IWG">Automotive</a></li><li><a href="http://iot.eclipse.org">Internet of Things</a></li><li><a href="http://locationtech.org">LocationTech</a></li><li><a href="http://lts.eclipse.org">Long-Term Support</a></li><li><a href="http://polarsys.org">PolarSys</a></li><li><a href="http://science.eclipse.org">Science</a></li><li><a href="http://www.openmdm.org">OpenMDM</a></li></ul></li>          <!-- More -->
          <li class="dropdown eclipse-more hidden-xs">
            <a data-toggle="dropdown" class="dropdown-toggle">More<b class="caret"></b></a>
            <ul class="dropdown-menu">
              <li>
                <!-- Content container to add padding -->
                <div class="yamm-content">
                  <div class="row">
                    <ul class="col-sm-8 list-unstyled"><li><p><strong>Community</strong></p></li><li><a href="http://marketplace.eclipse.org">Marketplace</a></li><li><a href="http://events.eclipse.org">Events</a></li><li><a href="http://www.planeteclipse.org/">Planet Eclipse</a></li><li><a href="https://www.eclipse.org/community/eclipse_newsletter/">Newsletter</a></li><li><a href="https://www.youtube.com/user/EclipseFdn">Videos</a></li></ul><ul class="col-sm-8 list-unstyled"><li><p><strong>Participate</strong></p></li><li><a href="https://bugs.eclipse.org/bugs/">Report a Bug</a></li><li><a href="https://www.eclipse.org/forums/">Forums</a></li><li><a href="https://www.eclipse.org/mail/">Mailing Lists</a></li><li><a href="https://wiki.eclipse.org/">Wiki</a></li><li><a href="https://wiki.eclipse.org/IRC">IRC</a></li><li><a href="https://www.eclipse.org/contribute/">How to Contribute</a></li></ul><ul class="col-sm-8 list-unstyled"><li><p><strong>Working Groups</strong></p></li><li><a href="http://wiki.eclipse.org/Auto_IWG">Automotive</a></li><li><a href="http://iot.eclipse.org">Internet of Things</a></li><li><a href="http://locationtech.org">LocationTech</a></li><li><a href="http://lts.eclipse.org">Long-Term Support</a></li><li><a href="http://polarsys.org">PolarSys</a></li><li><a href="http://science.eclipse.org">Science</a></li><li><a href="http://www.openmdm.org">OpenMDM</a></li></ul>                  </div>
                </div>
              </li>
            </ul>
          </li>
              </ul>
    </div>
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-collapse-1">
      <span class="sr-only">Toggle navigation</span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      </button>
      <div class="wrapper-logo-mobile"><a class="navbar-brand visible-xs" href="https://www.eclipse.org/"><img class="logo-eclipse-default-mobile img-responsive" alt="logo" src="https://bugs.eclipse.org/eclipse.org-common/themes/solstice/public/images/logo/eclipse-800x188.png"/></a></div>    </div>
  </div>
</div>
    </div>
  </div>
</header>
<!--  END OF SOLSTICE HEADER -->

    <div id="titles">
      <span id="title">Bugzilla &ndash; Bug&nbsp;129457</span>

        <span id="subtitle" class="subheader">Virtual Tree  very slow</span>

        <span id="information" class="header_addl_info">Last modified: 2021-07-01 02:40:50 EDT</span>
    </div>


    <div id="common_links"><ul class="links">
  <li><a href="./">Home</a></li>
  <li><span class="separator">| </span><a href="enter_bug.cgi">New</a></li>
  <li><span class="separator">| </span><a href="describecomponents.cgi">Browse</a></li>
  <li><span class="separator">| </span><a href="query.cgi">Search</a></li>

  <li class="form">
    <span class="separator">| </span>
    <form action="buglist.cgi" method="get"
        onsubmit="if (this.quicksearch.value == '')
                  { alert('Please enter one or more search terms first.');
                    return false; } return true;">
    <input type="hidden" id="no_redirect_top" name="no_redirect" value="0">
    <script type="text/javascript">
      if (history && history.replaceState) {
        var no_redirect = document.getElementById("no_redirect_top");
        no_redirect.value = 1;
      }
    </script>
    <input class="txt" type="text" id="quicksearch_top" name="quicksearch" 
           title="Quick Search" value="">
    <input class="btn" type="submit" value="Search" 
           id="find_top"></form>
  <a href="page.cgi?id=quicksearch.html" title="Quicksearch Help">[?]</a></li>

  <li><span class="separator">| </span><a href="report.cgi">Reports</a></li>

  <li>
      <span class="separator">| </span>
        <a href="request.cgi">Requests</a></li>


  <li>
        <span class="separator">| </span>
        <a href="https://bugzilla.readthedocs.org/en/5.0/using/understanding.html" target="_blank">Help</a>
      </li>
    

    <li id="mini_login_container_top">
  <span class="separator">| </span>
  <a id="login_link_top" href="show_bug.cgi?id=129457&amp;GoAheadAndLogIn=1"
     onclick="return show_mini_login_form('_top')">Log In</a>

  <form action="show_bug.cgi?id=129457" method="POST"
        class="mini_login bz_default_hidden"
        id="mini_login_top">
    <input id="Bugzilla_login_top" required
           name="Bugzilla_login" class="bz_login"
        placeholder="Login">
    <input class="bz_password" name="Bugzilla_password" type="password"
           id="Bugzilla_password_top" required
           placeholder="Password">
    <input type="hidden" name="Bugzilla_login_token"
           value="">
    <input type="submit" name="GoAheadAndLogIn" value="Log in"
            id="log_in_top">
    <a href="#" onclick="return hide_mini_login_form('_top')">[x]</a>
  </form>
</li>
  <span class="separator">| </span>
  <li><a href="http://www.eclipse.org/legal/termsofuse.php">Terms of Use</a></li>
  <span class="separator">| </span>
  <li><a href="http://www.eclipse.org/legal/copyright.php">Copyright Agent</a></li>
</ul>
    </div>
  </div>

  <div id="bugzilla-body">


<script type="text/javascript">
<!--

//-->
</script>

<form name="changeform" id="changeform" method="post" action="process_bug.cgi">

  <input type="hidden" name="delta_ts" value="2021-07-01 02:40:50">
  <input type="hidden" name="id" value="129457">
  <input type="hidden" name="token" value="1629873001-fNPEWIkpscsj2GUkrBxGh5qwWZZ0_w9578hBAvg-hNY">
<div class="bz_short_desc_container edit_form">
     <a href="show_bug.cgi?id=129457"><b>Bug&nbsp;129457</b></a> <span id="summary_container" class="bz_default_hidden">
      - <span id="short_desc_nonedit_display">Virtual Tree  very slow</span>
     </span>

    <div id="summary_input"><span class="field_label "
    id="field_label_short_desc">


  <a 
      title="The bug summary is a short sentence which succinctly describes what the bug is about."
      class="field_help_link"
      href="page.cgi?id=fields.html#short_desc"
  >Summary:</a>

</span>Virtual Tree  very slow
    </div>
  </div>
  <script type="text/javascript">
    hideEditableField('summary_container',
                      'summary_input',
                      'summary_edit_action',
                      'short_desc',
                      'Virtual Tree  very slow' );
  </script>
  <table class="edit_form">
    <tr>
      
      <td id="bz_show_bug_column_1" class="bz_show_bug_column">     
        <table>
          <tr>
    <th class="field_label">
      <a href="page.cgi?id=fields.html#bug_status">Status</a>:
    </th>
    <td id="bz_field_status">
      <span id="static_bug_status">CLOSED
          WONTFIX
      </span>
    </td>
  </tr>
<tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
<tr><th class="field_label "
    id="field_label_alias">


  <a 
      title="A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla."
      class="field_help_link"
      href="page.cgi?id=fields.html#alias"
  >Alias:</a>

</th>
    <td>
        None
    </td>
  </tr>
<tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
<tr><th class="field_label "
    id="field_label_product">


  <a 
      title="Bugs are categorised into Products and Components. Select a Classification to narrow down this list."
      class="field_help_link"
      href="describecomponents.cgi"
  >Product:</a>

</th>
  <td class="field_value "
      id="field_container_product" >Platform

</td>
    </tr>

    
    <tr class="bz_default_hidden"><th class="field_label "
    id="field_label_classification">


  <a 
      title="Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation."
      class="field_help_link"
      href="page.cgi?id=fields.html#classification"
  >Classification:</a>

</th>
  <td class="field_value "
      id="field_container_classification" >Eclipse Project

</td>
    </tr>
        
    
    
    <tr><th class="field_label "
    id="field_label_component">


  <a 
      title="Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list."
      class="field_help_link"
      href="describecomponents.cgi?product=Platform"
  >Component:</a>

</th>
  <td class="field_value "
      id="field_container_component" >SWT

  (<a href="buglist.cgi?component=SWT&amp;product=Platform&amp;bug_status=__open__"
      target="_blank">show other bugs</a>)
</td>
    </tr>
    <tr><th class="field_label "
    id="field_label_version">


  <a 
      title="The version field defines the version of the software the bug was found in."
      class="field_help_link"
      href="page.cgi?id=fields.html#version"
  >Version:</a>

</th>

      <td>3.2 &#160; <a href="https://dev.eclipse.org/committers/bugs/bugz_manager.php"><img src="//dev.eclipse.org/small_icons/apps/accessories-text-editor.png" alt="Edit" title="Edit these values" /></a></td>
    </tr>
        
    
        
    <tr><th class="field_label "
    id="field_label_rep_platform">


  <a 
      title="The hardware platform the bug was observed on. Note: When searching, selecting the option &quot;All&quot; only finds bugs whose value for this field is literally the word &quot;All&quot;."
      class="field_help_link"
      href="page.cgi?id=fields.html#rep_platform"
  >Hardware:</a>

</th>
      <td class="field_value">PC
        Windows XP
      </td>
    </tr>
          <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
          
          <tr>
      <th class="field_label">
        <label  accesskey="i">
          <a href="page.cgi?id=fields.html#importance"><u>I</u>mportance</a></label>:
      </th>
      <td>P3
       normal<span id="votes_container">
      with
      <a href="page.cgi?id=voting/bug.html&amp;bug_id=129457">18 
            votes</a>
    (<a href="page.cgi?id=voting/user.html&amp;bug_id=129457#vote_129457">vote</a>)
  </span>
      </td>
    </tr>

      <tr><th class="field_label "
    id="field_label_target_milestone">


  <a 
      title="The Target Milestone field is used to define when the engineer the bug is assigned to expects to fix it."
      class="field_help_link"
      href="page.cgi?id=fields.html#target_milestone"
  >Target Milestone:</a>

</th>
        <td>--- &#160; <a href="https://dev.eclipse.org/committers/bugs/bugz_manager.php"><img src="//dev.eclipse.org/small_icons/apps/accessories-text-editor.png" alt="Edit" title="Edit these values" /></a></td>
      </tr>
          
          <tr><th class="field_label "
    id="field_label_assigned_to">


  <a 
      title="The person in charge of resolving the bug."
      class="field_help_link"
      href="page.cgi?id=fields.html#assigned_to"
  >Assignee:</a>

</th>
      <td><span class="vcard"><span class="fn">Felipe Heidrich</span> <a href="http://wiki.eclipse.org/ECA"><img class="cla_dec" src="https://accounts.eclipse.org/user/eca/badge?mail=eclipse.felipe&#64;gmail.com" alt="CLA" title="Eclipse Contributor Agreement" /></a> <a href="https://eclipse.org/donate/"><img class="cla_dec" src="//www.eclipse.org/donate/web-api/friends_decorator.php?email=eclipse.felipe&#64;gmail.com" alt="Friend" title="Friend of Eclipse" /></a>
</span>
      </td>
    </tr>

    <tr><th class="field_label "
    id="field_label_qa_contact">


  <a 
      title="The person responsible for confirming this bug if it is unconfirmed, and for verifying the fix once the bug has been resolved."
      class="field_help_link"
      href="page.cgi?id=fields.html#qa_contact"
  >QA Contact:</a>

</th>
      <td><span class="vcard">
</span>
      </td>
    </tr>
    <script type="text/javascript">
      assignToDefaultOnChange(['product', 'component'],
        'platform-swt-inbox\x40eclipse.org',
        '');
    </script>
          <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
          <tr><th class="field_label "
    id="field_label_bug_file_loc">


  <a 
      title="Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen."
      class="field_help_link"
      href="page.cgi?id=fields.html#bug_file_loc"
  >URL:</a>

</th>
    <td>
      <span id="bz_url_input_area">
      </span>
    </td>
  </tr>

    <tr><th class="field_label "
    id="field_label_status_whiteboard">


  <a 
      title="Each bug has a free-form single line text entry box for adding tags and status information."
      class="field_help_link"
      href="page.cgi?id=fields.html#status_whiteboard"
  >Whiteboard:</a>

</th><td>stalebug  
  </td>
    </tr>

    <tr><th class="field_label "
    id="field_label_keywords">


  <a 
      title="You can add keywords from a defined list to bugs, in order to easily identify and group them."
      class="field_help_link"
      href="describekeywords.cgi"
  >Keywords:</a>

</th>
  <td class="field_value "
      id="field_container_keywords" >

</td>
    </tr>
          <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>

          <tr>
    <th class="field_label">
      <label>Duplicates (2)</label>:
    </th>
    <td class="field_value">
      <span id="duplicates"><a class="bz_bug_link 
          bz_status_RESOLVED  bz_closed"
   title="RESOLVED DUPLICATE - Virtual Tree: time of viewer.setChildCount(element, count) is linear with count"
   href="show_bug.cgi?id=149639">149639</a> <a class="bz_bug_link 
          bz_status_RESOLVED  bz_closed"
   title="RESOLVED DUPLICATE - On Vista, OS.SendMessage is very slow"
   href="show_bug.cgi?id=207342">207342</a> 
      </span>
      (<a href="buglist.cgi?bug_id=149639,207342">view as bug list</a>)
    </td>
  </tr>
<tr><th class="field_label "
    id="field_label_dependson">


  <a 
      title="The bugs listed here must be resolved before this bug can be resolved."
      class="field_help_link"
      href="page.cgi?id=fields.html#dependson"
  >Depends on:</a>

</th>

  <td>
    <span id="dependson_input_area">
    </span>

  </td>
  </tr>
  
  <tr><th class="field_label "
    id="field_label_blocked">


  <a 
      title="This bug must be resolved before the bugs listed in this field can be resolved."
      class="field_help_link"
      href="page.cgi?id=fields.html#blocked"
  >Blocks:</a>

</th>

  <td>
    <span id="blocked_input_area">
    </span>

  </td>
  </tr>
          
        </table>
      </td>
      <td>
        <div class="bz_column_spacer">&nbsp;</div>
      </td>
      
      <td id="bz_show_bug_column_2" class="bz_show_bug_column">
        <table>
        <tr>
    <th class="field_label">
      Reported:
    </th>
    <td>2006-02-25 13:06 EST by <span class="vcard"><span class="fn">Rutger Ovidius</span> <a href="http://wiki.eclipse.org/ECA"><img class="cla_dec" src="https://accounts.eclipse.org/user/eca/badge?mail=ovidr&#64;users.sourceforge.net" alt="CLA" title="Eclipse Contributor Agreement" /></a> <a href="https://eclipse.org/donate/"><img class="cla_dec" src="//www.eclipse.org/donate/web-api/friends_decorator.php?email=ovidr&#64;users.sourceforge.net" alt="Friend" title="Friend of Eclipse" /></a>
</span>
    </td>
  </tr>
  
  <tr>
    <th class="field_label">
      Modified:
    </th>
    <td>2021-07-01 02:40 EDT
      (<a href="show_activity.cgi?id=129457">History</a>)
    </td>
  
  </tr>
<tr>
      <th class="field_label">
        <label  accesskey="a">
          CC List:
        </label>
      </th>
      <td>32 
          users
          <span id="cc_edit_area_showhide_container" class="bz_default_hidden">
            (<a href="#" id="cc_edit_area_showhide">show</a>)
          </span>
        <div id="cc_edit_area">
          <br>
            <select id="cc" multiple="multiple" size="5" >
                <option value="309849305">309849305</option>
                <option value="andi_dm1">andi_dm1</option>
                <option value="andy-eclipsebugs">andy-eclipsebugs</option>
                <option value="bruno.do.medeiros">bruno.do.medeiros</option>
                <option value="cpuidle">cpuidle</option>
                <option value="digga1404">digga1404</option>
                <option value="eclipse.sprigogin">eclipse.sprigogin</option>
                <option value="eclipse">eclipse</option>
                <option value="elias">elias</option>
                <option value="francois">francois</option>
                <option value="gheorghe">gheorghe</option>
                <option value="gregoryr">gregoryr</option>
                <option value="ilaborie">ilaborie</option>
                <option value="irwin">irwin</option>
                <option value="jan.hvozdovic">jan.hvozdovic</option>
                <option value="lding">lding</option>
                <option value="lubomir">lubomir</option>
                <option value="ludwig.mittermeier">ludwig.mittermeier</option>
                <option value="mail">mail</option>
                <option value="olivier.prouvost">olivier.prouvost</option>
                <option value="pelouas">pelouas</option>
                <option value="pierre-charles.david">pierre-charles.david</option>
                <option value="pombredanne">pombredanne</option>
                <option value="public">public</option>
                <option value="sebastian.zarnekow">sebastian.zarnekow</option>
                <option value="shashwat.work">shashwat.work</option>
                <option value="Silenio_Quarti">Silenio_Quarti</option>
                <option value="strider80">strider80</option>
                <option value="torkildr">torkildr</option>
                <option value="wuut">wuut</option>
                <option value="yoli.ignatov">yoli.ignatov</option>
                <option value="zulliger">zulliger</option>
            </select>
        </div>
          <script type="text/javascript">
            hideEditableField( 'cc_edit_area_showhide_container', 
                               'cc_edit_area', 
                               'cc_edit_area_showhide', 
                               '', 
                               '');  
          </script>
      </td>
    </tr>

<tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
<tr><th class="field_label "
    id="field_label_see_also">


  <a 
      title="This allows you to refer to bugs in other installations. You can enter a URL to a bug in the 'Add Bug URLs' field to note that that bug is related to this one. You can enter multiple URLs at once by separating them with whitespace. You should normally use this field to refer to bugs in other installations. For bugs in this installation, it is better to use the Depends on and Blocks fields."
      class="field_help_link"
      href="page.cgi?id=fields.html#see_also"
  >See Also:</a>

</th>
  <td class="field_value "
      id="field_container_see_also" ><ul class="bug_urls">
          <li><img src="//dev.eclipse.org/images/bugs-16x16.png"> <a class="bz_bug_link 
          bz_status_NEW "
   title="NEW - [win32] Optimize bulk inserting/deleting items for Tree"
   href="show_bug.cgi?id=549171">549171</a>
          </li></ul>

</td>
    </tr> 

<tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>



        </table>
      </td>
    </tr>
    <tr>
      <td colspan="3">
          <hr id="bz_top_half_spacer">
      </td>
    </tr>
  </table>

  <table id="bz_big_form_parts">
  <tr>
  <td>

    
<script type="text/javascript">
<!--
function toggle_display(link) {
    var table = document.getElementById("attachment_table");
    var view_all = document.getElementById("view_all");
    var hide_obsolete_url_parameter = "&hide_obsolete=1";
    // Store current height for scrolling later
    var originalHeight = table.offsetHeight;
    var rows = YAHOO.util.Dom.getElementsByClassName(
        'bz_tr_obsolete', 'tr', table);

    for (var i = 0; i < rows.length; i++) {
        bz_toggleClass(rows[i], 'bz_default_hidden');
    }

    if (YAHOO.util.Dom.hasClass(rows[0], 'bz_default_hidden')) {
        link.innerHTML = "Show Obsolete";
        view_all.href = view_all.href + hide_obsolete_url_parameter 
    }
    else {
        link.innerHTML = "Hide Obsolete";
        view_all.href = view_all.href.replace(hide_obsolete_url_parameter,"");
    }

    var newHeight = table.offsetHeight;
    // This scrolling makes the window appear to not move at all.
    window.scrollBy(0, newHeight - originalHeight);

    return false;
}
//-->
</script>

<br>
<table id="attachment_table">
  <tr id="a0">
    <th colspan="3" class="left">
      Attachments
    </th>
  </tr>


      <tr id="a1" class="bz_contenttype_application_octet-stream">
        <td>
            <a href="attachment.cgi?id=77040"
               title="View the content of the attachment">
          <b>Perf test case for setItemCount()</b></a>

          <span class="bz_attach_extra_info">
              (4.21 KB,
                application/octet-stream)

            <br>
            <a href="#attach_77040"
               title="Go to the comment associated with the attachment">2007-08-27 11:40 EDT</a>,

            <span class="vcard"><span class="fn">Irwin</span> <a href="http://wiki.eclipse.org/ECA"><img class="cla_dec" src="https://accounts.eclipse.org/user/eca/badge?mail=irwin&#64;google.com" alt="CLA" title="Eclipse Contributor Agreement" /></a> <a href="https://eclipse.org/donate/"><img class="cla_dec" src="//www.eclipse.org/donate/web-api/friends_decorator.php?email=irwin&#64;google.com" alt="Friend" title="Friend of Eclipse" /></a>
</span>
          </span>
        </td>

          <td class="bz_attach_flags">
              <i>no flags</i>
          </td>

        <td>
          <a href="attachment.cgi?id=77040&amp;action=edit">Details</a>
        </td>
      </tr>
      <tr id="a2" class="bz_contenttype_application_octet-stream">
        <td>
            <a href="attachment.cgi?id=164096"
               title="View the content of the attachment">
          <b>testcase</b></a>

          <span class="bz_attach_extra_info">
              (3.48 KB,
                application/octet-stream)

            <br>
            <a href="#attach_164096"
               title="Go to the comment associated with the attachment">2010-04-07 12:54 EDT</a>,

            <span class="vcard"><span class="fn">Felipe Heidrich</span> <a href="http://wiki.eclipse.org/ECA"><img class="cla_dec" src="https://accounts.eclipse.org/user/eca/badge?mail=eclipse.felipe&#64;gmail.com" alt="CLA" title="Eclipse Contributor Agreement" /></a> <a href="https://eclipse.org/donate/"><img class="cla_dec" src="//www.eclipse.org/donate/web-api/friends_decorator.php?email=eclipse.felipe&#64;gmail.com" alt="Friend" title="Friend of Eclipse" /></a>
</span>
          </span>
        </td>

          <td class="bz_attach_flags">
              <i>no flags</i>
          </td>

        <td>
          <a href="attachment.cgi?id=164096&amp;action=edit">Details</a>
        </td>
      </tr>

  <tr class="bz_attach_footer">
    <td colspan="3">
        <span class="bz_attach_view_hide">
            <a id="view_all" href="attachment.cgi?bugid=129457&amp;action=viewall">View All</a>
        </span>
        <a href="attachment.cgi?bugid=129457&amp;action=enter">Add an attachment</a>
        (proposed patch, testcase, etc.)
    </td>
  </tr>
</table>
<br>
<div id="add_comment" class="bz_section_additional_comments">
      <table>
        <tr>
          <td>
            <fieldset>
              <legend>Note</legend>
              You need to
              <a href="show_bug.cgi?id=129457&amp;GoAheadAndLogIn=1">log in</a>
              before you can comment on or make changes to this bug.
            </fieldset>
          </td>
        </tr> 
      </table>
  </div>
  </td>
  <td>
  </td>
  </tr></table>

  
  <div id="comments"><script src="https://bugs.eclipse.org/bugs/js/comments.js?1463425338" type="text/javascript">
</script>

<script type="text/javascript">
<!--
  /* Adds the reply text to the 'comment' textarea */
  function replyToComment(id, real_id, name) {
      var prefix = "(In reply to " + name + " from comment #" + id + ")\n";
      var replytext = "";
        /* pre id="comment_name_N" */
        var text_elem = document.getElementById('comment_text_'+id);
        var text = getText(text_elem);
        replytext = prefix + wrapReplyText(text);


      /* <textarea id="comment"> */
      var textarea = document.getElementById('comment');
      if (textarea.value != replytext) {
          textarea.value += replytext;
      }

      textarea.focus();
  } 
//-->
</script>


<!-- This auto-sizes the comments and positions the collapse/expand links 
     to the right. -->
<table class="bz_comment_table">
<tr>
<td>
<div id="c0" class="bz_comment bz_first_comment">

      <div class="bz_first_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=129457#c0">Description</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Rutger Ovidius</span> <a href="http://wiki.eclipse.org/ECA"><img class="cla_dec" src="https://accounts.eclipse.org/user/eca/badge?mail=ovidr&#64;users.sourceforge.net" alt="CLA" title="Eclipse Contributor Agreement" /></a> <a href="https://eclipse.org/donate/"><img class="cla_dec" src="//www.eclipse.org/donate/web-api/friends_decorator.php?email=ovidr&#64;users.sourceforge.net" alt="Friend" title="Friend of Eclipse" /></a>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2006-02-25 13:06:20 EST
        </span>

      </div>




<pre class="bz_comment_text">3.2M5  3224  win32.

I have altered Snippet 144 to show both a virtual table and tree. 

The COUNT variable was reduced from 1 million or it would never complete on the tree.

The virtual tree is incredibly slow. 
Table: 70ms
Tree: 6810ms

Further, scrolling up and down in the table is smooth. In the tree it is flickering and slow.


public class Snippet144 {

  static final int COUNT = 20000;
  
  public static void main(String[] args) {
    Display display = new Display();
    final Shell shell = new Shell(display);
    shell.setLayout(new RowLayout(SWT.VERTICAL));
    final Table table = new Table(shell, SWT.VIRTUAL | SWT.BORDER | SWT.FULL_SELECTION);
    final Tree tree = new Tree(shell, SWT.VIRTUAL | SWT.BORDER | SWT.FULL_SELECTION);
    
    table.addListener(SWT.SetData, new Listener() {
      public void handleEvent(Event event) {
        TableItem item = (TableItem) event.item;
        int index = table.indexOf(item);
        item.setText(&quot;Item &quot; + index);
        System.out.println(&quot;TABLE: &quot; + item.getText());
      }
    });
    
    tree.addListener(SWT.SetData, new Listener() {
      public void handleEvent(Event event) {
        TreeItem item = (TreeItem) event.item;
        int index = tree.indexOf(item);
        item.setText(&quot;Item &quot; + index);
        System.out.println(&quot;TREE: &quot; + item.getText());
      }
    });
    
    table.setLayoutData(new RowData(200, 200));
    tree.setLayoutData(new RowData(200, 200));
    
    Button button = new Button(shell, SWT.PUSH);
    button.setText(&quot;Add Items&quot;);
    final Label label = new Label(shell, SWT.NONE);
    final Label label2 = new Label(shell, SWT.NONE);
    
    button.addListener(SWT.Selection, new Listener() {
      public void handleEvent(Event event) {
        long t1 = System.currentTimeMillis();
        table.setItemCount(COUNT);
        long t2 = System.currentTimeMillis();
        label.setText(&quot;TABLE Items: &quot; + COUNT + &quot;, Time: &quot; + (t2 - t1) + &quot; (ms)&quot;);
        
        t1 = System.currentTimeMillis();
        tree.setItemCount(COUNT);
        t2 = System.currentTimeMillis();
        label2.setText(&quot;TREE Items: &quot; + COUNT + &quot;, Time: &quot; + (t2 - t1) + &quot; (ms)&quot;);
        
        
        shell.layout();
      }
    });
    
    shell.pack();
    shell.open();
    System.err.println(SWT.getVersion());
    while (!shell.isDisposed()) {
      if (!display.readAndDispatch())
        display.sleep();
    }
    display.dispose();
  }
}</pre>
    </div>

    <div id="c1" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=129457#c1">Comment 1</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Steve Northover</span> <a href="http://wiki.eclipse.org/ECA"><img class="cla_dec" src="https://accounts.eclipse.org/user/eca/badge?mail=snorthov&#64;ca.ibm.com" alt="CLA" title="Eclipse Contributor Agreement" /></a> <a href="https://eclipse.org/donate/"><img class="cla_dec" src="//www.eclipse.org/donate/web-api/friends_decorator.php?email=snorthov&#64;ca.ibm.com" alt="Friend" title="Friend of Eclipse" /></a>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2006-02-27 19:02:48 EST
        </span>

      </div>




<pre class="bz_comment_text">There is a hard limit on Windows around 32767 when adding items to a single level of a tree gets very slow.  There's not much I can do about it.</pre>
    </div>

    <div id="c2" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=129457#c2">Comment 2</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Rutger Ovidius</span> <a href="http://wiki.eclipse.org/ECA"><img class="cla_dec" src="https://accounts.eclipse.org/user/eca/badge?mail=ovidr&#64;users.sourceforge.net" alt="CLA" title="Eclipse Contributor Agreement" /></a> <a href="https://eclipse.org/donate/"><img class="cla_dec" src="//www.eclipse.org/donate/web-api/friends_decorator.php?email=ovidr&#64;users.sourceforge.net" alt="Friend" title="Friend of Eclipse" /></a>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2006-02-27 20:27:41 EST
        </span>

      </div>




<pre class="bz_comment_text">Even with an item count less than 32767 there is quite a big difference.

setItemCount:

2500 items: Table: 70ms, Tree: 260ms     
5000 items: Table: 70ms, Tree: 639ms
10000 items: Table: 70ms, Tree: 3526ms
20000 items: Table: 70ms, Tree: 11528ms
30000 items: Table: 70ms, Tree: 15014ms
32700 items: Table: 70ms, Tree: 18290ms
40000 items: Table: 70ms, Tree: 27291ms


20000 &lt; 32767</pre>
    </div>

    <div id="c3" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=129457#c3">Comment 3</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Ivan Bojer</span> <a href="http://wiki.eclipse.org/ECA"><img class="cla_dec" src="https://accounts.eclipse.org/user/eca/badge?mail=public&#64;bojerco.com" alt="CLA" title="Eclipse Contributor Agreement" /></a> <a href="https://eclipse.org/donate/"><img class="cla_dec" src="//www.eclipse.org/donate/web-api/friends_decorator.php?email=public&#64;bojerco.com" alt="Friend" title="Friend of Eclipse" /></a>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2006-04-03 17:38:58 EDT
        </span>

      </div>




<pre class="bz_comment_text">I believe that this is exact problem as <a class="bz_bug_link 
          bz_status_CLOSED  bz_closed"
   title="CLOSED WONTFIX - Tree.createItem() has bad performance"
   href="show_bug.cgi?id=113526">BUG #113526</a>. I ran some tests and here is a comparison between Linux (FC4) and windoze:

Calling setItemCount on a virtual tree with number of nodes &quot;n&quot; yields:

#of nodes    Windows     Linux (FC4)

10000          8s         0s
20000         29s         3s
30000         63s         7s
40000        103s        16s
50000        251s        27s
100000        -         127s

...because framework spends most of the time in Tree.createItem(...) method allocating space for a tree nodes.</pre>
    </div>

    <div id="c4" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=129457#c4">Comment 4</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Steve Northover</span> <a href="http://wiki.eclipse.org/ECA"><img class="cla_dec" src="https://accounts.eclipse.org/user/eca/badge?mail=snorthov&#64;ca.ibm.com" alt="CLA" title="Eclipse Contributor Agreement" /></a> <a href="https://eclipse.org/donate/"><img class="cla_dec" src="//www.eclipse.org/donate/web-api/friends_decorator.php?email=snorthov&#64;ca.ibm.com" alt="Friend" title="Friend of Eclipse" /></a>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2006-07-05 11:09:19 EDT
        </span>

      </div>




<pre class="bz_comment_text">*** <a class="bz_bug_link 
          bz_status_RESOLVED  bz_closed"
   title="RESOLVED DUPLICATE - Virtual Tree: time of viewer.setChildCount(element, count) is linear with count"
   href="show_bug.cgi?id=149639">Bug 149639</a> has been marked as a duplicate of this bug. ***</pre>
    </div>

    <div id="c5" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=129457#c5">Comment 5</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Steve Northover</span> <a href="http://wiki.eclipse.org/ECA"><img class="cla_dec" src="https://accounts.eclipse.org/user/eca/badge?mail=snorthov&#64;ca.ibm.com" alt="CLA" title="Eclipse Contributor Agreement" /></a> <a href="https://eclipse.org/donate/"><img class="cla_dec" src="//www.eclipse.org/donate/web-api/friends_decorator.php?email=snorthov&#64;ca.ibm.com" alt="Friend" title="Friend of Eclipse" /></a>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2006-09-26 14:09:26 EDT
        </span>

      </div>




<pre class="bz_comment_text">See <a href="http://support.microsoft.com/default.aspx?scid=kb;en-us;Q182231">http://support.microsoft.com/default.aspx?scid=kb;en-us;Q182231</a> for a description of the problem from the MSDN.</pre>
    </div>

    <div id="c6" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=129457#c6">Comment 6</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Irwin</span> <a href="http://wiki.eclipse.org/ECA"><img class="cla_dec" src="https://accounts.eclipse.org/user/eca/badge?mail=irwin&#64;google.com" alt="CLA" title="Eclipse Contributor Agreement" /></a> <a href="https://eclipse.org/donate/"><img class="cla_dec" src="//www.eclipse.org/donate/web-api/friends_decorator.php?email=irwin&#64;google.com" alt="Friend" title="Friend of Eclipse" /></a>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2007-08-24 19:24:00 EDT
        </span>

      </div>




<pre class="bz_comment_text">I think there s a more serious issue. Even once the tree is built, adding a single item takes a lot of time (linear in number of elements) because of setItemCount()

which takes a time linear to the number of entries to update the item count because of this code :

                while (hItem != 0 &amp;&amp; itemCount &lt; count) {
                        hItem = OS.SendMessage(handle, OS.TVM_GETNEXTITEM,
OS.TVGN_NEXT, hItem);
                        itemCount++;


it looks like it tries to find the last item of the tree by starting from the root and then scanning the whole tree. Can't we make that more efficient ? (like caching the last item ? )

see <a class="bz_bug_link 
          bz_status_RESOLVED  bz_closed"
   title="RESOLVED FIXED - [Viewers] TreeViewer performance issues"
   href="show_bug.cgi?id=200214">BUG 200214</a></pre>
    </div>

    <div id="c7" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=129457#c7">Comment 7</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Steve Northover</span> <a href="http://wiki.eclipse.org/ECA"><img class="cla_dec" src="https://accounts.eclipse.org/user/eca/badge?mail=snorthov&#64;ca.ibm.com" alt="CLA" title="Eclipse Contributor Agreement" /></a> <a href="https://eclipse.org/donate/"><img class="cla_dec" src="//www.eclipse.org/donate/web-api/friends_decorator.php?email=snorthov&#64;ca.ibm.com" alt="Friend" title="Friend of Eclipse" /></a>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2007-08-24 20:54:32 EDT
        </span>

      </div>




<pre class="bz_comment_text">Can you prove that this loop is causing the problem?  There is a cache that Tree.findIndex() and Tree.findItem() that could also be used in this case.  These methods return the index or the item and keep track of the last index and HTREEITEM.

It's a bit tricky because Tree.setItemCount() method needs both the count and the last HTREEITEM in case it needs to delete items instead of adding them but it is doable.  The code is quite delecate and I'd like to make sure it makes a difference before changing it.</pre>
    </div>

    <div id="c8" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=129457#c8">Comment 8</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Irwin</span> <a href="http://wiki.eclipse.org/ECA"><img class="cla_dec" src="https://accounts.eclipse.org/user/eca/badge?mail=irwin&#64;google.com" alt="CLA" title="Eclipse Contributor Agreement" /></a> <a href="https://eclipse.org/donate/"><img class="cla_dec" src="//www.eclipse.org/donate/web-api/friends_decorator.php?email=irwin&#64;google.com" alt="Friend" title="Friend of Eclipse" /></a>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2007-08-27 11:07:52 EDT
        </span>

      </div>




<pre class="bz_comment_text">Yes I confirm the bottleneck is in this loop.
I timed with a 75K items tree (under XP), and adding an element through the viewer.add() API takes 150 ms.
That s exactly the time it takes to go over this loop (75k iterations):

		while (hItem != 0 &amp;&amp; itemCount &lt; count) {
			hItem = OS.SendMessage(handle, OS.TVM_GETNEXTITEM, OS.TVGN_NEXT, hItem);
			itemCount++;
		}


Let me know if there s a patch/fix you want me to test (to leverage the cache you mentionned).

</pre>
    </div>

    <div id="c9" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=129457#c9">Comment 9</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Steve Northover</span> <a href="http://wiki.eclipse.org/ECA"><img class="cla_dec" src="https://accounts.eclipse.org/user/eca/badge?mail=snorthov&#64;ca.ibm.com" alt="CLA" title="Eclipse Contributor Agreement" /></a> <a href="https://eclipse.org/donate/"><img class="cla_dec" src="//www.eclipse.org/donate/web-api/friends_decorator.php?email=snorthov&#64;ca.ibm.com" alt="Friend" title="Friend of Eclipse" /></a>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2007-08-27 11:18:57 EDT
        </span>

      </div>




<pre class="bz_comment_text">Please attach the benchmark code.</pre>
    </div>

    <div id="c10" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=129457#c10">Comment 10</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Irwin</span> <a href="http://wiki.eclipse.org/ECA"><img class="cla_dec" src="https://accounts.eclipse.org/user/eca/badge?mail=irwin&#64;google.com" alt="CLA" title="Eclipse Contributor Agreement" /></a> <a href="https://eclipse.org/donate/"><img class="cla_dec" src="//www.eclipse.org/donate/web-api/friends_decorator.php?email=irwin&#64;google.com" alt="Friend" title="Friend of Eclipse" /></a>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2007-08-27 11:40:54 EDT
        </span>

      </div>




<pre class="bz_comment_text">Created <span class=""><a href="attachment.cgi?id=77040" name="attach_77040" title="Perf test case for setItemCount()">attachment 77040</a> <a href="attachment.cgi?id=77040&amp;action=edit" title="Perf test case for setItemCount()">[details]</a></span>
Perf test case for setItemCount()

Run the test case, it will create a virtual tree with high number of entries.
Then press the 'enter' key in the console to add an element.
Put some timing around the Tree.setItemCount() loop code :

		long start = System.currentTimeMillis();
		while (hItem != 0 &amp;&amp; itemCount &lt; count) {
			hItem = OS.SendMessage(handle, OS.TVM_GETNEXTITEM, OS.TVGN_NEXT, hItem);
			itemCount++;
		}
		System.err.println(&quot;setItemCount &quot; + (System.currentTimeMillis() - start));

And you will see that this loop takes around 100 ms to complete.</pre>
    </div>

    <div id="c11" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=129457#c11">Comment 11</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Steve Northover</span> <a href="http://wiki.eclipse.org/ECA"><img class="cla_dec" src="https://accounts.eclipse.org/user/eca/badge?mail=snorthov&#64;ca.ibm.com" alt="CLA" title="Eclipse Contributor Agreement" /></a> <a href="https://eclipse.org/donate/"><img class="cla_dec" src="//www.eclipse.org/donate/web-api/friends_decorator.php?email=snorthov&#64;ca.ibm.com" alt="Friend" title="Friend of Eclipse" /></a>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2007-08-27 12:59:58 EDT
        </span>

      </div>




<pre class="bz_comment_text">My initial investigation shows that the optimization has no effect for 5000 items.  I'm still looking into it to make sure that the caching code is running.</pre>
    </div>

    <div id="c12" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=129457#c12">Comment 12</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Irwin</span> <a href="http://wiki.eclipse.org/ECA"><img class="cla_dec" src="https://accounts.eclipse.org/user/eca/badge?mail=irwin&#64;google.com" alt="CLA" title="Eclipse Contributor Agreement" /></a> <a href="https://eclipse.org/donate/"><img class="cla_dec" src="//www.eclipse.org/donate/web-api/friends_decorator.php?email=irwin&#64;google.com" alt="Friend" title="Friend of Eclipse" /></a>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2007-08-27 13:45:49 EDT
        </span>

      </div>




<pre class="bz_comment_text">(In reply to <a href="show_bug.cgi?id=129457#c11">comment #11</a>)
<span class="quote">&gt; My initial investigation shows that the optimization has no effect for 5000
&gt; items.  I'm still looking into it to make sure that the caching code is
&gt; running.
&gt; </span >
Depending on how fast your machine is, 5000 may not show much improvement.
Try it with at least 50 000.  (when I run 5000 items, I get 0 or 16 ms latency, which is probably due to context switching)
</pre>
    </div>

    <div id="c13" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=129457#c13">Comment 13</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Irwin</span> <a href="http://wiki.eclipse.org/ECA"><img class="cla_dec" src="https://accounts.eclipse.org/user/eca/badge?mail=irwin&#64;google.com" alt="CLA" title="Eclipse Contributor Agreement" /></a> <a href="https://eclipse.org/donate/"><img class="cla_dec" src="//www.eclipse.org/donate/web-api/friends_decorator.php?email=irwin&#64;google.com" alt="Friend" title="Friend of Eclipse" /></a>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2007-09-04 16:03:51 EDT
        </span>

      </div>




<pre class="bz_comment_text">Steve, any luck ? 
Do you have anything i can test ? 


</pre>
    </div>

    <div id="c14" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=129457#c14">Comment 14</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Steve Northover</span> <a href="http://wiki.eclipse.org/ECA"><img class="cla_dec" src="https://accounts.eclipse.org/user/eca/badge?mail=snorthov&#64;ca.ibm.com" alt="CLA" title="Eclipse Contributor Agreement" /></a> <a href="https://eclipse.org/donate/"><img class="cla_dec" src="//www.eclipse.org/donate/web-api/friends_decorator.php?email=snorthov&#64;ca.ibm.com" alt="Friend" title="Friend of Eclipse" /></a>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2007-10-25 16:18:50 EDT
        </span>

      </div>




<pre class="bz_comment_text">*** <a class="bz_bug_link 
          bz_status_RESOLVED  bz_closed"
   title="RESOLVED DUPLICATE - On Vista, OS.SendMessage is very slow"
   href="show_bug.cgi?id=207342">Bug 207342</a> has been marked as a duplicate of this bug. ***</pre>
    </div>

    <div id="c15" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=129457#c15">Comment 15</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Lubomir Marinov</span> <a href="http://wiki.eclipse.org/ECA"><img class="cla_dec" src="https://accounts.eclipse.org/user/eca/badge?mail=lubomir&#64;deltopia.com" alt="CLA" title="Eclipse Contributor Agreement" /></a> <a href="https://eclipse.org/donate/"><img class="cla_dec" src="//www.eclipse.org/donate/web-api/friends_decorator.php?email=lubomir&#64;deltopia.com" alt="Friend" title="Friend of Eclipse" /></a>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2008-03-24 16:07:46 EDT
        </span>

      </div>




<pre class="bz_comment_text">I20080207-1530

Steps to reproduce:
The following time statistics have been acquired from a Tree loaded with tens of thousands of TreeItems, with a relatively small number of TreeItems parented in a single TreeItem (20 at most), and approximately 2/3 of them being expanded. The resulting times for each method are rounded to 65,000 invocations. The comparison is of the performance of the respective methods of Tree and TreeItem in the cases of Tree without and with the SWT.VIRTUAL flag. The time statistics are averages of 5 runs of each case, the &quot;without&quot; and the &quot;with&quot; runs are run one after the other once, then the cycle is repeated again in order to minimize the effects of the differences in the execution environment.

What happens:
                             Windows             Mac OS X
                         without   with        without   with

Tree.createItem            854     1439          111     123
TreeItem.setBackground     34      51            368     412
TreeItem.setForeground     3       8             4       5
TreeItem.setImage          598     827           19      31
TreeItem.setText           273     472           93      116

Mac OS X seems to be pretty fast in the described scenario and doesn't seem to show a noticeable difference between running without and with the SWT.VIRTUAL flag.

However, the SWT Tree on Windows seems to perform noticeably slower in SWT.VIRTUAL mode.

What should happen:
The understanding is that SWT.VIRTUAL should allow for noticeably better performance on large hierarchies.

I've been looking at the mentioned methods and I've been trying to understand the reason for SWT.VIRTUAL being slower and I'm adding this comment because I don't really see that much of a difference in the code of the said methods.</pre>
    </div>

    <div id="c16" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=129457#c16">Comment 16</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Simon Chemouil</span> <a href="http://wiki.eclipse.org/ECA"><img class="cla_dec" src="https://accounts.eclipse.org/user/eca/badge?mail=eclipse&#64;mithrandir.net" alt="CLA" title="Eclipse Contributor Agreement" /></a> <a href="https://eclipse.org/donate/"><img class="cla_dec" src="//www.eclipse.org/donate/web-api/friends_decorator.php?email=eclipse&#64;mithrandir.net" alt="Friend" title="Friend of Eclipse" /></a>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2009-10-14 09:44:43 EDT
        </span>

      </div>




<pre class="bz_comment_text">I confirm the bug here.

When there are &quot;many&quot; (from 1000 to 10000, that's far less than 2^15-1):

(1) In virtual mode (Win32)
- The scrollbar SWT Virtual trees under Win32 is barely usable
- Selecting items in the node lags seconds behind the actual click
- Navigating with the keyboard is nearly impossible


(2) Non Virtual mode (Win32)
- The scrollbar behaves perfectly fine (very well in fact)
- Selecting items in the node still lags seconds behind the actual click
- Navigating with the keyboard is still nearly impossible (probably because of the selection)

The main difference between (1) and (2) is the time required to open the parent node (obviously way faster with 1).


Those problems are inexistent when running GNU/Linux + GTK.


Now, from my non-scientific tests, snooping around and trying to get performance out of the tree widget for a few days, my idea is that there are two distinct problems:
- the selection problem, under Win32, which has to do with bad random access performances in a node with many children (ie, selecting the nth children quickly)
- the scrollbar problem is distinct and only happens in virtual mode, I believe it has to do with the cost of creating the TreeItems while scrolling (maybe Windows doesn't like that in its UI thread, but then again I have no knowledge of Win32).


You got my vote for this bug.</pre>
    </div>

    <div id="c17" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=129457#c17">Comment 17</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Felipe Heidrich</span> <a href="http://wiki.eclipse.org/ECA"><img class="cla_dec" src="https://accounts.eclipse.org/user/eca/badge?mail=eclipse.felipe&#64;gmail.com" alt="CLA" title="Eclipse Contributor Agreement" /></a> <a href="https://eclipse.org/donate/"><img class="cla_dec" src="//www.eclipse.org/donate/web-api/friends_decorator.php?email=eclipse.felipe&#64;gmail.com" alt="Friend" title="Friend of Eclipse" /></a>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2009-10-16 12:23:44 EDT
        </span>

      </div>




<pre class="bz_comment_text">(In reply to <a href="show_bug.cgi?id=129457#c13">comment #13</a>)
<span class="quote">&gt; Steve, any luck ? 
&gt; Do you have anything i can test ?</span >

Hi Irwin, Steve is no longer working here.
As much as I can I'll be working on the bugs that are assigned to him.

For while loop you refer to in <a href="show_bug.cgi?id=129457#c8">comment 8</a>, I removed the entire loop (my testcase never calls setItemCount to decrease the number of items). I got no performance improvement removing the loop. The time is not there.</pre>
    </div>

    <div id="c18" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=129457#c18">Comment 18</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Simon Chemouil</span> <a href="http://wiki.eclipse.org/ECA"><img class="cla_dec" src="https://accounts.eclipse.org/user/eca/badge?mail=eclipse&#64;mithrandir.net" alt="CLA" title="Eclipse Contributor Agreement" /></a> <a href="https://eclipse.org/donate/"><img class="cla_dec" src="//www.eclipse.org/donate/web-api/friends_decorator.php?email=eclipse&#64;mithrandir.net" alt="Friend" title="Friend of Eclipse" /></a>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2010-04-02 09:00:30 EDT
        </span>

      </div>




<pre class="bz_comment_text">Is there any news for that bug, any chance to get it fixed for Helios or very soon thereafter? It is a major blocker for our application.</pre>
    </div>

    <div id="c19" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=129457#c19">Comment 19</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Felipe Heidrich</span> <a href="http://wiki.eclipse.org/ECA"><img class="cla_dec" src="https://accounts.eclipse.org/user/eca/badge?mail=eclipse.felipe&#64;gmail.com" alt="CLA" title="Eclipse Contributor Agreement" /></a> <a href="https://eclipse.org/donate/"><img class="cla_dec" src="//www.eclipse.org/donate/web-api/friends_decorator.php?email=eclipse.felipe&#64;gmail.com" alt="Friend" title="Friend of Eclipse" /></a>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2010-04-07 12:54:58 EDT
        </span>

      </div>




<pre class="bz_comment_text">Created <span class=""><a href="attachment.cgi?id=164096" name="attach_164096" title="testcase">attachment 164096</a> <a href="attachment.cgi?id=164096&amp;action=edit" title="testcase">[details]</a></span>
testcase

I don't have a fix for this problem.

In win32, Table (ListView) has native support for virtual (see LVS_OWNERDATA and LVM_SETITEMCOUNT) does not. Tree (Tree-View) does not have the same support.

Try the attachemnt, see that an unsubclassed TreeView is just as slow as the SWT Tree. All the time is in TVM_INSERTITEM, which we are forced to call.</pre>
    </div>

    <div id="c20" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=129457#c20">Comment 20</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">jan</span> <a href="http://wiki.eclipse.org/ECA"><img class="cla_dec" src="https://accounts.eclipse.org/user/eca/badge?mail=jan.hvozdovic&#64;honeywell.com" alt="CLA" title="Eclipse Contributor Agreement" /></a> <a href="https://eclipse.org/donate/"><img class="cla_dec" src="//www.eclipse.org/donate/web-api/friends_decorator.php?email=jan.hvozdovic&#64;honeywell.com" alt="Friend" title="Friend of Eclipse" /></a>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2010-11-01 15:22:20 EDT
        </span>

      </div>




<pre class="bz_comment_text">Hi, 

unfortunately I met the same problem as you are describing in this forum.

In the last comment there is reference to MSDN

I am newbie in SWT but I think there is possibility to implement virtual tree with this flag I_CHILDRENCALLBACK.

Maybe you can see the following article <a href="http://www.codeguru.com/cpp/cpp/cpp_mfc/callbacks/article.php/c16667">http://www.codeguru.com/cpp/cpp/cpp_mfc/callbacks/article.php/c16667</a>

Is it possible to use this callback technique in SWT tree?

Thanks,
Jan</pre>
    </div>

    <div id="c21" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=129457#c21">Comment 21</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Sebastian Bauer</span> <a href="http://wiki.eclipse.org/ECA"><img class="cla_dec" src="https://accounts.eclipse.org/user/eca/badge?mail=mail&#64;sebastianbauer.info" alt="CLA" title="Eclipse Contributor Agreement" /></a> <a href="https://eclipse.org/donate/"><img class="cla_dec" src="//www.eclipse.org/donate/web-api/friends_decorator.php?email=mail&#64;sebastianbauer.info" alt="Friend" title="Friend of Eclipse" /></a>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2011-04-07 06:25:58 EDT
        </span>

      </div>




<pre class="bz_comment_text">I also find the virtual tree very slow in Linux/GTK not only for Windows. If I increase the item count of Snippet202 to say 20000, it needs about 10 seconds for the window coming up.</pre>
    </div>

    <div id="c22" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=129457#c22">Comment 22</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Yang Lu</span> <a href="http://wiki.eclipse.org/ECA"><img class="cla_dec" src="https://accounts.eclipse.org/user/eca/badge?mail=309849305&#64;qq.com" alt="CLA" title="Eclipse Contributor Agreement" /></a> <a href="https://eclipse.org/donate/"><img class="cla_dec" src="//www.eclipse.org/donate/web-api/friends_decorator.php?email=309849305&#64;qq.com" alt="Friend" title="Friend of Eclipse" /></a>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2012-02-28 13:31:09 EST
        </span>

      </div>




<pre class="bz_comment_text">I find the virtual tree very slow in SWT3.7
I dynamic change setItemCount, performance has improved.
-------------------------------------------------------------------------
package com.swt.example;

import org.eclipse.swt.SWT;
import org.eclipse.swt.events.TreeAdapter;
import org.eclipse.swt.events.TreeEvent;
import org.eclipse.swt.layout.FillLayout;
import org.eclipse.swt.layout.GridData;
import org.eclipse.swt.layout.GridLayout;
import org.eclipse.swt.widgets.Composite;
import org.eclipse.swt.widgets.Display;
import org.eclipse.swt.widgets.Event;
import org.eclipse.swt.widgets.Listener;
import org.eclipse.swt.widgets.Shell;
import org.eclipse.swt.widgets.Tree;
import org.eclipse.swt.widgets.TreeItem;
/**
 * &#64;author LuYang
 * www.suntodo.com
 */
public class TestTreeVirtual extends Shell {
	
	public static int TEST_COUNTS = 100000;
	/**
	 * Launch the application.
	 * &#64;param args
	 */
	public static void main(String args[]) {
		try {
			Display display = Display.getDefault();
			TestTreeVirtual shell = new TestTreeVirtual(display);
			shell.open();
			shell.layout();
			while (!shell.isDisposed()) {
				if (!display.readAndDispatch()) {
					display.sleep();
				}
			}
		} catch (Exception e) {
			e.printStackTrace();
		}
	}

	/**
	 * Create the shell.
	 * &#64;param display
	 */
	public TestTreeVirtual(Display display) {
		super(display, SWT.SHELL_TRIM);
		setLayout(new FillLayout(SWT.HORIZONTAL));
		
		Composite composite = new TreeVirtualDynamicExample(this, SWT.NONE);
		createContents();
	}

	/**
	 * Create contents of the shell.
	 */
	protected void createContents() {
		setText(&quot;SWT Application&quot;);
		setSize(450, 300);

	}

	&#64;Override
	protected void checkSubclass() {
		// Disable the check that prevents subclassing of SWT components
	}
}

class TreeVirtualDynamicExample extends Composite{
	private Tree tree;
	public static String TREEITEM_LOADING = &quot;TREEITEM_LOADING&quot;;
	/**
	 * Create the composite.
	 * &#64;param parent
	 * &#64;param style
	 */
	public TreeVirtualDynamicExample(Composite parent, int style) {
		super(parent, style);
		setLayout(new GridLayout(1, false));
		
		tree = new Tree(this, SWT.BORDER | SWT.VIRTUAL);
		tree.setLinesVisible(true);
		tree.setLayoutData(new GridData(SWT.FILL, SWT.FILL, true, true, 1, 1));

		// create Virtual Tree	
		String root1 = new String(&quot;Root1&quot;);
		String root2 = new String(&quot;Root2&quot;);		
		createTree(tree, new Object[]{root1,root2});
	}
	
	public void createTree(final Tree tree, final Object[] roots) {

		class TreeSetDataListener implements Listener {
			
	        public void handleEvent(Event event) {	
				TreeItem currentItem = (TreeItem)event.item;
				TreeItem parentItem = currentItem.getParentItem();

				final Object child;
				Object[] currentAndBrother = null;
				int currentItemIndex;// 
				int currentIndex = 0;//

				if (parentItem == null) {// root Item
					currentAndBrother = (Object[]) tree.getData();
					currentItemIndex  = tree.indexOf(currentItem);
					currentIndex = currentItemIndex;
					child = currentAndBrother[currentIndex];
					createOwnLoadingItem(currentItem);
					
				}else{// not root node
					Object data = (Object) parentItem.getData();
					
					// loading Item
					if(data!=null &amp;&amp; data.equals(TREEITEM_LOADING)){
						currentItem.setText(&quot;loading&quot;);
						child = null;

					// a Item	
					}else if(data!=null &amp;&amp; data instanceof Object[]){
						currentAndBrother =(Object[]) data;
						currentItemIndex  = parentItem.indexOf(currentItem);
						currentIndex  = currentItemIndex-1;
						// check currentIndex
						if(currentIndex&gt;=0 &amp;&amp; currentIndex&lt;currentAndBrother.length)
							child = currentAndBrother[currentIndex];
						else
							child = null;
						createOwnLoadingItem(currentItem);

					}else{
						child = null;
					}
				}
				
				if(child!=null) {
					currentItem.setText(getText(child));

					TreeItem belongLoading = getBelongLoadingItem(currentItem);
					updateLoadingItem(currentItem, currentIndex-1, currentAndBrother, belongLoading);
					disposeLoadingItem(currentItem, currentIndex-1, currentAndBrother, belongLoading);
			
					if(parentItem!=null &amp;&amp; parentItem.getItemCount() &lt;= currentAndBrother.length){
						parentItem.setItemCount(parentItem.getItemCount()+1);
					}					
				}
	        }
	    }		

		class TreeListener extends TreeAdapter {
			&#64;Override
			public void treeExpanded(TreeEvent e) {		
				TreeItem currentItem = (TreeItem) e.item;				
				createChildren(currentItem);
			}
		}
		tree.addListener(SWT.SetData, new TreeSetDataListener());
		tree.addTreeListener(new TreeListener());	
		
		// create virtual Tree					
		createRoots(tree, roots);		
	}

	public void createRoots(Tree tree, Object[] roots) {
		tree.setData(roots);	
		tree.setItemCount(roots.length);		
	}
	
	public void createChildren(final TreeItem currentItem){	
		
		final Object child = currentItem.getData();

		Thread thread = new Thread() {
			public void run() {
				if (tree.isDisposed()) return;
				final Object[] children = getChildren(child);		
				
				Display.getDefault().asyncExec(new Runnable () {
				//Display.getDefault().syncExec(new Runnable() {
					public void run() {
						if(!currentItem.isDisposed()){
							//currentItem.clearAll(true);
							currentItem.setData(children);
							currentItem.setItemCount(currentItem.getItemCount()+1);// display + 
						}
					};												
				});
			};
		};
		thread.start();
	}

	public TreeItem createOwnLoadingItem(TreeItem currentItem) {
		TreeItem ownLoading=null;
		if(currentItem.getItemCount()==0){
			//currentItem.setItemCount(1);
			ownLoading = new TreeItem(currentItem, 0);
			ownLoading.setText(&quot;loading...&quot;);
		}
		return ownLoading;
	}
	
	public TreeItem getBelongLoadingItem(TreeItem currentItem) {
		TreeItem loading = null;
		if(currentItem.getParentItem()!=null){
			loading=currentItem.getParentItem().getItems()[0];
			if(loading!=null &amp;&amp; loading.getData()!=null) {
				if(loading.getData().equals(TREEITEM_LOADING))
					return loading;
			}
		}			
		return loading;
	}

	public void updateLoadingItem(TreeItem currentItem, int currentIndex, Object[] currentAndBorther, TreeItem belongLoading){
		if(belongLoading!=null &amp;&amp; !belongLoading.isDisposed())
			belongLoading.setText((currentIndex+1)+&quot;/&quot;+currentAndBorther.length);
	}	
	
	public void disposeLoadingItem(TreeItem currentItem, int currentIndex, Object[] currentAndBorther, TreeItem belongLoading){
		if(belongLoading!=null &amp;&amp; !belongLoading.isDisposed() &amp;&amp; currentIndex+1==currentAndBorther.length){
			belongLoading.dispose();
		}			
	}	
	
	public Object[] getChildren(Object parent){
		String[] children = new String[TestTreeVirtual.TEST_COUNTS];
		for (int i = 0; i &lt; children.length; i++) {
			children[i] = &quot;child&quot;+&quot;-&quot;+i;
		}
		return children;
	}

	public String getText(Object element){
		return element.toString();
	}
	
	&#64;Override
	protected void checkSubclass() {
		// Disable the check that prevents subclassing of SWT components
	}
	
	public Tree getTree() {
		return tree;
	}

}</pre>
    </div>

    <div id="c23" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=129457#c23">Comment 23</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Henno Vermeulen</span> <a href="http://wiki.eclipse.org/ECA"><img class="cla_dec" src="https://accounts.eclipse.org/user/eca/badge?mail=strider80&#64;hotmail.com" alt="CLA" title="Eclipse Contributor Agreement" /></a> <a href="https://eclipse.org/donate/"><img class="cla_dec" src="//www.eclipse.org/donate/web-api/friends_decorator.php?email=strider80&#64;hotmail.com" alt="Friend" title="Friend of Eclipse" /></a>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2015-10-26 10:59:45 EDT
        </span>

      </div>




<pre class="bz_comment_text">Unfortunately almost 10 years later I am still seeing this same performance issue in our Eclipse RCP application using Windows 8 and the (somewhat outdated) SWT version 3.7.2.

I am using an SWT Tree through the JFace TreeViewer.

Populating a non-virtual tree with 4000 root items takes about 1 second which is even longer than the delay caused by our database query! This is rather annoying for a good user experience.

This issue can easily be reproduced by copy/pasting Snippet002TreeViewer and adjusting the number of nodes.

I thought SWT.VIRTUAL was supposed to address this issue, but similar to what is seen in <a href="show_bug.cgi?id=129457#c15">Comment 15</a>, the tree now takes about 50% longer to create. (I copy/pasted/adjusted Snippet047VirtualLazyTreeViewer).

Are there any known ways of improving this?

I found a workaround that may be (barely) acceptable for user experience: creating a single &quot;All items&quot; root node and adding the 4000 tree items. This tree can be created in about 10ms instead of 1000ms. Expanding the root node takes around 500ms instead of 1000ms.
Perhaps creating artificial categories (A, B, C .. Z) can help even more.</pre>
    </div>

    <div id="c24" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=129457#c24">Comment 24</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Henno Vermeulen</span> <a href="http://wiki.eclipse.org/ECA"><img class="cla_dec" src="https://accounts.eclipse.org/user/eca/badge?mail=strider80&#64;hotmail.com" alt="CLA" title="Eclipse Contributor Agreement" /></a> <a href="https://eclipse.org/donate/"><img class="cla_dec" src="//www.eclipse.org/donate/web-api/friends_decorator.php?email=strider80&#64;hotmail.com" alt="Friend" title="Friend of Eclipse" /></a>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2015-10-27 04:48:18 EDT
        </span>

      </div>




<pre class="bz_comment_text">I ran the altered Snippet144.

It's interesting that 10 years later on a very high end pc, the virtual table takes about the same time, even more: 7090ms. The table now takes 20ms.

Is this some kind of Windows task scheduling policy that has never changed?</pre>
    </div>

    <div id="c25" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=129457#c25">Comment 25</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Henno Vermeulen</span> <a href="http://wiki.eclipse.org/ECA"><img class="cla_dec" src="https://accounts.eclipse.org/user/eca/badge?mail=strider80&#64;hotmail.com" alt="CLA" title="Eclipse Contributor Agreement" /></a> <a href="https://eclipse.org/donate/"><img class="cla_dec" src="//www.eclipse.org/donate/web-api/friends_decorator.php?email=strider80&#64;hotmail.com" alt="Friend" title="Friend of Eclipse" /></a>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2015-10-27 05:25:29 EDT
        </span>

      </div>




<pre class="bz_comment_text">(In reply to Henno Vermeulen from <a href="show_bug.cgi?id=129457#c24">comment #24</a>)
Correction, the virtual tree takes 7090ms. (Virtual tables are very fast in my experience)</pre>
    </div>

    <div id="c26" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=129457#c26">Comment 26</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Henno Vermeulen</span> <a href="http://wiki.eclipse.org/ECA"><img class="cla_dec" src="https://accounts.eclipse.org/user/eca/badge?mail=strider80&#64;hotmail.com" alt="CLA" title="Eclipse Contributor Agreement" /></a> <a href="https://eclipse.org/donate/"><img class="cla_dec" src="//www.eclipse.org/donate/web-api/friends_decorator.php?email=strider80&#64;hotmail.com" alt="Friend" title="Friend of Eclipse" /></a>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2015-10-27 06:34:16 EDT
        </span>

      </div>




<pre class="bz_comment_text">I can confirm that the bottleneck is in the OS.SendMessage call of type TVM_INSERTITEM as mentioned in <a href="show_bug.cgi?id=129457#c19">Comment 19</a>.

It's in this line in Tree.createItem:

hNewItem = OS.SendMessage(handle, OS.TVM_INSERTITEM, 0, tvInsert);

Creating 5000 tree items takes 1103ms of which 1024ms is spent in this line of code.</pre>
    </div>

    <div id="c27" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=129457#c27">Comment 27</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Henno Vermeulen</span> <a href="http://wiki.eclipse.org/ECA"><img class="cla_dec" src="https://accounts.eclipse.org/user/eca/badge?mail=strider80&#64;hotmail.com" alt="CLA" title="Eclipse Contributor Agreement" /></a> <a href="https://eclipse.org/donate/"><img class="cla_dec" src="//www.eclipse.org/donate/web-api/friends_decorator.php?email=strider80&#64;hotmail.com" alt="Friend" title="Friend of Eclipse" /></a>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2015-10-27 08:02:19 EDT
        </span>

      </div>




<pre class="bz_comment_text">I investigated this deeper and I'm afraid there's not much there can be done except looking for alternatives, such as:

- other technology such as Nebula nattable or use Swing's JTree
- reduce the number of children per node by adding extra tree nodes. Even putting all items below a single root node seems to help a bit.
- reusing the same Tree instead of destroying and rebuilding it.
- when using JFace's TreeViewer and setting different input, perhaps the SWT Tree could internally keep existing tree items around and reuse them for the new input instead of destroying + re-adding them


Details:
The following line in Tree.createItem is the culprit:

hNewItem = OS.SendMessage(handle, OS.TVM_INSERTITEM, 0, tvInsert);

The tvInsert structure contains a hInsertAfter handle to the item after which the new item is to be inserted.

According to MSDN's documentation on TVINSERTSTRUCT
<a href="https://msdn.microsoft.com/en-us/library/windows/desktop/bb773452(v=vs.85).aspx">https://msdn.microsoft.com/en-us/library/windows/desktop/bb773452(v=vs.85).aspx</a>

&quot;Important: Using TVI_LAST to insert an item into a tree-view node that already contains a large number of items can take a long time, causing the application to stop responding until the insert operation completes.&quot;

So I tried a few alternatives: TVI_ROOT, the previous handle, the first handle, and TVI_FIRST. Using the first handle or TVI_FIRST takes about 10% less time for 5000 nodes and about 30% for 20000 nodes. It is something but not the performance increase I was hoping for.

According to this blog <a href="http://www.virtualdub.org/blog/pivot/entry.php?id=184">http://www.virtualdub.org/blog/pivot/entry.php?id=184</a> the Win32 tree view internally stores its nodes as a singly-linked list and adding an item to the end takes linear time according to the number of items. It suggests to add nodes in reverse order.

When inserting in the front, the time doesn't drastically decrease so there must still be something else going on why the OS call is so slow.</pre>
    </div>

    <div id="c28" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=129457#c28">Comment 28</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Eclipse Genie</span> <a href="http://wiki.eclipse.org/ECA"><img class="cla_dec" src="https://accounts.eclipse.org/user/eca/badge?mail=genie&#64;eclipse.org" alt="CLA" title="Eclipse Contributor Agreement" /></a> <a href="https://eclipse.org/donate/"><img class="cla_dec" src="//www.eclipse.org/donate/web-api/friends_decorator.php?email=genie&#64;eclipse.org" alt="Friend" title="Friend of Eclipse" /></a>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2021-07-01 02:40:50 EDT
        </span>

      </div>




<pre class="bz_comment_text">This bug hasn't had any activity in quite some time. Maybe the problem got resolved, was a duplicate of something else, or became less pressing for some reason - or maybe it's still relevant but just hasn't been looked at yet. As such, we're closing this bug.

If you have further information on the current state of the bug, please add it and reopen this bug. The information can be, for example, that the problem still occurs, that you still want the feature, that more information is needed, or that the bug is (for whatever reason) no longer relevant.

--
The automated Eclipse Genie.</pre>
    </div>


  

</td>
<td>
</td>
</tr></table>
  </div>
        

</form>

<hr>
<ul class="related_actions">
    <li><a href="show_bug.cgi?format=multiple&amp;id=129457">Format For Printing</a></li>
    <li>&nbsp;-&nbsp;<a href="show_bug.cgi?ctype=xml&amp;id=129457">XML</a></li>
    <li>&nbsp;-&nbsp;<a href="enter_bug.cgi?cloned_bug_id=129457">Clone This Bug</a></li>
    
    <li>&nbsp;-&nbsp;<a href="#">Top of page </a></li>
    </ul>

<br>
</div>

    <div id="footer">
      <div class="intro"></div>
<ul id="useful-links">
  <li id="links-actions"><ul class="links">
  <li><a href="./">Home</a></li>
  <li><span class="separator">| </span><a href="enter_bug.cgi">New</a></li>
  <li><span class="separator">| </span><a href="describecomponents.cgi">Browse</a></li>
  <li><span class="separator">| </span><a href="query.cgi">Search</a></li>

  <li class="form">
    <span class="separator">| </span>
    <form action="buglist.cgi" method="get"
        onsubmit="if (this.quicksearch.value == '')
                  { alert('Please enter one or more search terms first.');
                    return false; } return true;">
    <input type="hidden" id="no_redirect_bottom" name="no_redirect" value="0">
    <script type="text/javascript">
      if (history && history.replaceState) {
        var no_redirect = document.getElementById("no_redirect_bottom");
        no_redirect.value = 1;
      }
    </script>
    <input class="txt" type="text" id="quicksearch_bottom" name="quicksearch" 
           title="Quick Search" value="">
    <input class="btn" type="submit" value="Search" 
           id="find_bottom"></form>
  <a href="page.cgi?id=quicksearch.html" title="Quicksearch Help">[?]</a></li>

  <li><span class="separator">| </span><a href="report.cgi">Reports</a></li>

  <li>
      <span class="separator">| </span>
        <a href="request.cgi">Requests</a></li>


  <li>
        <span class="separator">| </span>
        <a href="https://bugzilla.readthedocs.org/en/5.0/using/understanding.html" target="_blank">Help</a>
      </li>
    

    <li id="mini_login_container_bottom">
  <span class="separator">| </span>
  <a id="login_link_bottom" href="show_bug.cgi?id=129457&amp;GoAheadAndLogIn=1"
     onclick="return show_mini_login_form('_bottom')">Log In</a>

  <form action="show_bug.cgi?id=129457" method="POST"
        class="mini_login bz_default_hidden"
        id="mini_login_bottom">
    <input id="Bugzilla_login_bottom" required
           name="Bugzilla_login" class="bz_login"
        placeholder="Login">
    <input class="bz_password" name="Bugzilla_password" type="password"
           id="Bugzilla_password_bottom" required
           placeholder="Password">
    <input type="hidden" name="Bugzilla_login_token"
           value="">
    <input type="submit" name="GoAheadAndLogIn" value="Log in"
            id="log_in_bottom">
    <a href="#" onclick="return hide_mini_login_form('_bottom')">[x]</a>
  </form>
</li>
  <span class="separator">| </span>
  <li><a href="http://www.eclipse.org/legal/termsofuse.php">Terms of Use</a></li>
  <span class="separator">| </span>
  <li><a href="http://www.eclipse.org/legal/copyright.php">Copyright Agent</a></li>
</ul>
  </li>

  




  
</ul>

      <div class="outro"></div>
    </div>

  </body>
</html>