<!DOCTYPE html>
<html lang="en">
  <head>
    <title>113675 &ndash; [Viewers] TreeViewer fails to persist user-selected expanded/collapsed nodes for a multi-level deep tree</title>

      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<link href="https://bugs.eclipse.org/bugs/data/assets/03c4bb46b12126a79867f9a9f5323634.css?1593441374" rel="stylesheet" type="text/css">



    
<script type="text/javascript" src="https://bugs.eclipse.org/bugs/data/assets/a7c2f3a028f17a9aa60f56dc9d6e732d.js?1593441374"></script>

    <script type="text/javascript">
    <!--
        YAHOO.namespace('bugzilla');
        YAHOO.util.Event.addListener = function (el, sType, fn, obj, overrideContext) {
               if ( ("onpagehide" in window || YAHOO.env.ua.gecko) && sType === "unload") { sType = "pagehide"; };
               var capture = ((sType == "focusin" || sType == "focusout") && !YAHOO.env.ua.ie) ? true : false;
               return this._addListener(el, this._getType(sType), fn, obj, overrideContext, capture);
         };
        if ( "onpagehide" in window || YAHOO.env.ua.gecko) {
            YAHOO.util.Event._simpleRemove(window, "unload", 
                                           YAHOO.util.Event._unload);
        }
        
        function unhide_language_selector() { 
            YAHOO.util.Dom.removeClass(
                'lang_links_container', 'bz_default_hidden'
            ); 
        } 
        YAHOO.util.Event.onDOMReady(unhide_language_selector);

        
        var BUGZILLA = {
            param: {
                cookiepath: '\/bugs',
                maxusermatches: 10
            },
            constant: {
                COMMENT_COLS: 80
            },
            string: {
                

                attach_desc_required:
                    "You must enter a Description for this attachment.",
                component_required:
                    "You must select a Component for this bug.",
                description_required:
                    "You must enter a Description for this bug.",
                short_desc_required:
                    "You must enter a Summary for this bug.",
                version_required:
                    "You must select a Version for this bug."
            }
              , api_token: ''
        };

    if (history && history.replaceState) {
      if(!document.location.href.match(/show_bug\.cgi/)) {
        history.replaceState( null,
                             "113675 – [Viewers] TreeViewer fails to persist user-selected expanded\/collapsed nodes for a multi-level deep tree",
                             "show_bug.cgi?id=113675" );
        document.title = "113675 – [Viewers] TreeViewer fails to persist user-selected expanded\/collapsed nodes for a multi-level deep tree";
      }
      if (document.location.href.match(/show_bug\.cgi\?.*list_id=/)) {
        var href = document.location.href;
        href = href.replace(/[\?&]+list_id=(\d+|cookie)/, '');
        history.replaceState(null, "113675 – [Viewers] TreeViewer fails to persist user-selected expanded\/collapsed nodes for a multi-level deep tree", href);
      }
    }
    YAHOO.util.Event.onDOMReady(function() {
      initDirtyFieldTracking();

    });
    // -->
    </script>
<script type="text/javascript" src="https://bugs.eclipse.org/bugs/data/assets/daf5e0fb6826e6a35280e622913f0c4a.js?1593441374"></script>

    

    
    <link rel="search" type="application/opensearchdescription+xml"
                       title="Bugzilla" href="./search_plugin.cgi">
    <link rel="shortcut icon" href="images/favicon.ico">
  </head>

  <body 
        class="bugs-eclipse-org-bugs
                 bz_bug
                 bz_status_CLOSED
                 bz_product_Platform
                 bz_component_UI
                 bz_bug_113675 yui-skin-sam">

  <div id="header"><!-- 1.0@bugzilla.org -->





<!--  START OF SOLSTICE HEADER -->
 <link rel="stylesheet" type="text/css" href="https://www.eclipse.org/eclipse.org-common/themes/solstice/public/stylesheets/vendor/cookieconsent/cookieconsent.min.css" />
 <script src="https://www.eclipse.org/eclipse.org-common/themes/solstice/public/javascript/vendor/cookieconsent/default.min.js"></script>
 <style type="text/css">
    @import url('https://www.eclipse.org/eclipse.org-common/themes/solstice/public/stylesheets/barebone.min.css')
    </style>
    <script
      src="https://www.eclipse.org/eclipse.org-common/themes/solstice/public/javascript/barebone.min.js">
    </script><header role="banner" class="barebone-layout thin-header padding-top-5 padding-bottom-5"  id="header-wrapper">
  <div class="container-fluid reset">
    <div class="row-fluid" id="header-row">
            <div class="col-sm-8 col-md-6 col-lg-4" id="header-left">
        <div class="wrapper-logo-default"><a href="https://www.eclipse.org/"><img class="logo-eclipse-default img-responsive hidden-xs" alt="logo" src="https://bugs.eclipse.org/eclipse.org-common/themes/solstice/public/images/logo/eclipse-426x100.png"/></a></div>
      </div>            <div class="col-sm-16 col-md-18 col-lg-20" id="main-menu-wrapper">
  <div class="navbar yamm" id="main-menu">
    <div id="navbar-collapse-1" class="navbar-collapse collapse">
      <ul class="nav navbar-nav navbar-right">
        <li class="visible-thin"><a href="https://www.eclipse.org/downloads/" target="_self">Download</a></li><li><a href="https://www.eclipse.org/users/" target="_self">Getting Started</a></li><li><a href="https://www.eclipse.org/membership/" target="_self">Members</a></li><li><a href="https://www.eclipse.org/projects/" target="_self">Projects</a></li>                  <li class="dropdown visible-xs"><a href="#" data-toggle="dropdown" class="dropdown-toggle">Community <b class="caret"></b></a><ul class="dropdown-menu"><li><a href="http://marketplace.eclipse.org">Marketplace</a></li><li><a href="http://events.eclipse.org">Events</a></li><li><a href="http://www.planeteclipse.org/">Planet Eclipse</a></li><li><a href="https://www.eclipse.org/community/eclipse_newsletter/">Newsletter</a></li><li><a href="https://www.youtube.com/user/EclipseFdn">Videos</a></li></ul></li><li class="dropdown visible-xs"><a href="#" data-toggle="dropdown" class="dropdown-toggle">Participate <b class="caret"></b></a><ul class="dropdown-menu"><li><a href="https://bugs.eclipse.org/bugs/">Report a Bug</a></li><li><a href="https://www.eclipse.org/forums/">Forums</a></li><li><a href="https://www.eclipse.org/mail/">Mailing Lists</a></li><li><a href="https://wiki.eclipse.org/">Wiki</a></li><li><a href="https://wiki.eclipse.org/IRC">IRC</a></li><li><a href="https://www.eclipse.org/contribute/">How to Contribute</a></li></ul></li><li class="dropdown visible-xs"><a href="#" data-toggle="dropdown" class="dropdown-toggle">Working Groups <b class="caret"></b></a><ul class="dropdown-menu"><li><a href="http://wiki.eclipse.org/Auto_IWG">Automotive</a></li><li><a href="http://iot.eclipse.org">Internet of Things</a></li><li><a href="http://locationtech.org">LocationTech</a></li><li><a href="http://lts.eclipse.org">Long-Term Support</a></li><li><a href="http://polarsys.org">PolarSys</a></li><li><a href="http://science.eclipse.org">Science</a></li><li><a href="http://www.openmdm.org">OpenMDM</a></li></ul></li>          <!-- More -->
          <li class="dropdown eclipse-more hidden-xs">
            <a data-toggle="dropdown" class="dropdown-toggle">More<b class="caret"></b></a>
            <ul class="dropdown-menu">
              <li>
                <!-- Content container to add padding -->
                <div class="yamm-content">
                  <div class="row">
                    <ul class="col-sm-8 list-unstyled"><li><p><strong>Community</strong></p></li><li><a href="http://marketplace.eclipse.org">Marketplace</a></li><li><a href="http://events.eclipse.org">Events</a></li><li><a href="http://www.planeteclipse.org/">Planet Eclipse</a></li><li><a href="https://www.eclipse.org/community/eclipse_newsletter/">Newsletter</a></li><li><a href="https://www.youtube.com/user/EclipseFdn">Videos</a></li></ul><ul class="col-sm-8 list-unstyled"><li><p><strong>Participate</strong></p></li><li><a href="https://bugs.eclipse.org/bugs/">Report a Bug</a></li><li><a href="https://www.eclipse.org/forums/">Forums</a></li><li><a href="https://www.eclipse.org/mail/">Mailing Lists</a></li><li><a href="https://wiki.eclipse.org/">Wiki</a></li><li><a href="https://wiki.eclipse.org/IRC">IRC</a></li><li><a href="https://www.eclipse.org/contribute/">How to Contribute</a></li></ul><ul class="col-sm-8 list-unstyled"><li><p><strong>Working Groups</strong></p></li><li><a href="http://wiki.eclipse.org/Auto_IWG">Automotive</a></li><li><a href="http://iot.eclipse.org">Internet of Things</a></li><li><a href="http://locationtech.org">LocationTech</a></li><li><a href="http://lts.eclipse.org">Long-Term Support</a></li><li><a href="http://polarsys.org">PolarSys</a></li><li><a href="http://science.eclipse.org">Science</a></li><li><a href="http://www.openmdm.org">OpenMDM</a></li></ul>                  </div>
                </div>
              </li>
            </ul>
          </li>
              </ul>
    </div>
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-collapse-1">
      <span class="sr-only">Toggle navigation</span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      </button>
      <div class="wrapper-logo-mobile"><a class="navbar-brand visible-xs" href="https://www.eclipse.org/"><img class="logo-eclipse-default-mobile img-responsive" alt="logo" src="https://bugs.eclipse.org/eclipse.org-common/themes/solstice/public/images/logo/eclipse-800x188.png"/></a></div>    </div>
  </div>
</div>
    </div>
  </div>
</header>
<!--  END OF SOLSTICE HEADER -->

    <div id="titles">
      <span id="title">Bugzilla &ndash; Bug&nbsp;113675</span>

        <span id="subtitle" class="subheader">[Viewers] TreeViewer fails to persist user-selected expanded/collapsed nodes for a multi-level deep tree</span>

        <span id="information" class="header_addl_info">Last modified: 2020-07-23 19:15:34 EDT</span>
    </div>


    <div id="common_links"><ul class="links">
  <li><a href="./">Home</a></li>
  <li><span class="separator">| </span><a href="enter_bug.cgi">New</a></li>
  <li><span class="separator">| </span><a href="describecomponents.cgi">Browse</a></li>
  <li><span class="separator">| </span><a href="query.cgi">Search</a></li>

  <li class="form">
    <span class="separator">| </span>
    <form action="buglist.cgi" method="get"
        onsubmit="if (this.quicksearch.value == '')
                  { alert('Please enter one or more search terms first.');
                    return false; } return true;">
    <input type="hidden" id="no_redirect_top" name="no_redirect" value="0">
    <script type="text/javascript">
      if (history && history.replaceState) {
        var no_redirect = document.getElementById("no_redirect_top");
        no_redirect.value = 1;
      }
    </script>
    <input class="txt" type="text" id="quicksearch_top" name="quicksearch" 
           title="Quick Search" value="">
    <input class="btn" type="submit" value="Search" 
           id="find_top"></form>
  <a href="page.cgi?id=quicksearch.html" title="Quicksearch Help">[?]</a></li>

  <li><span class="separator">| </span><a href="report.cgi">Reports</a></li>

  <li>
      <span class="separator">| </span>
        <a href="request.cgi">Requests</a></li>


  <li>
        <span class="separator">| </span>
        <a href="https://bugzilla.readthedocs.org/en/5.0/using/understanding.html" target="_blank">Help</a>
      </li>
    

    <li id="mini_login_container_top">
  <span class="separator">| </span>
  <a id="login_link_top" href="show_bug.cgi?id=113675&amp;GoAheadAndLogIn=1"
     onclick="return show_mini_login_form('_top')">Log In</a>

  <form action="show_bug.cgi?id=113675" method="POST"
        class="mini_login bz_default_hidden"
        id="mini_login_top">
    <input id="Bugzilla_login_top" required
           name="Bugzilla_login" class="bz_login"
        placeholder="Login">
    <input class="bz_password" name="Bugzilla_password" type="password"
           id="Bugzilla_password_top" required
           placeholder="Password">
    <input type="hidden" name="Bugzilla_login_token"
           value="">
    <input type="submit" name="GoAheadAndLogIn" value="Log in"
            id="log_in_top">
    <a href="#" onclick="return hide_mini_login_form('_top')">[x]</a>
  </form>
</li>
  <span class="separator">| </span>
  <li><a href="http://www.eclipse.org/legal/termsofuse.php">Terms of Use</a></li>
  <span class="separator">| </span>
  <li><a href="http://www.eclipse.org/legal/copyright.php">Copyright Agent</a></li>
</ul>
    </div>
  </div>

  <div id="bugzilla-body">


<script type="text/javascript">
<!--

//-->
</script>

<form name="changeform" id="changeform" method="post" action="process_bug.cgi">

  <input type="hidden" name="delta_ts" value="2020-07-23 19:15:34">
  <input type="hidden" name="id" value="113675">
  <input type="hidden" name="token" value="1629863408-xBjFL7XO0nmaXU6jMkIqjYmLwV7e_yZdv-Rlg78owbQ">
<div class="bz_short_desc_container edit_form">
     <a href="show_bug.cgi?id=113675"><b>Bug&nbsp;113675</b></a> <span id="summary_container" class="bz_default_hidden">
      - <span id="short_desc_nonedit_display">[Viewers] TreeViewer fails to persist user-selected expanded/collapsed nodes for a multi-level deep tree</span>
     </span>

    <div id="summary_input"><span class="field_label "
    id="field_label_short_desc">


  <a 
      title="The bug summary is a short sentence which succinctly describes what the bug is about."
      class="field_help_link"
      href="page.cgi?id=fields.html#short_desc"
  >Summary:</a>

</span><span title="[Viewers] TreeViewer fails to persist user-selected expanded/collapsed nodes for a multi-level deep tree">[Viewers] TreeViewer fails to persist user-selected expanded/collapsed nodes ...
        </span>
    </div>
  </div>
  <script type="text/javascript">
    hideEditableField('summary_container',
                      'summary_input',
                      'summary_edit_action',
                      'short_desc',
                      '[Viewers] TreeViewer fails to persist user-selected expanded\/collapsed nodes for a multi-level deep tree' );
  </script>
  <table class="edit_form">
    <tr>
      
      <td id="bz_show_bug_column_1" class="bz_show_bug_column">     
        <table>
          <tr>
    <th class="field_label">
      <a href="page.cgi?id=fields.html#bug_status">Status</a>:
    </th>
    <td id="bz_field_status">
      <span id="static_bug_status">CLOSED
          WONTFIX
      </span>
    </td>
  </tr>
<tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
<tr><th class="field_label "
    id="field_label_alias">


  <a 
      title="A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla."
      class="field_help_link"
      href="page.cgi?id=fields.html#alias"
  >Alias:</a>

</th>
    <td>
        None
    </td>
  </tr>
<tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
<tr><th class="field_label "
    id="field_label_product">


  <a 
      title="Bugs are categorised into Products and Components. Select a Classification to narrow down this list."
      class="field_help_link"
      href="describecomponents.cgi"
  >Product:</a>

</th>
  <td class="field_value "
      id="field_container_product" >Platform

</td>
    </tr>

    
    <tr class="bz_default_hidden"><th class="field_label "
    id="field_label_classification">


  <a 
      title="Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation."
      class="field_help_link"
      href="page.cgi?id=fields.html#classification"
  >Classification:</a>

</th>
  <td class="field_value "
      id="field_container_classification" >Eclipse Project

</td>
    </tr>
        
    
    
    <tr><th class="field_label "
    id="field_label_component">


  <a 
      title="Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list."
      class="field_help_link"
      href="describecomponents.cgi?product=Platform"
  >Component:</a>

</th>
  <td class="field_value "
      id="field_container_component" >UI

  (<a href="buglist.cgi?component=UI&amp;product=Platform&amp;bug_status=__open__"
      target="_blank">show other bugs</a>)
</td>
    </tr>
    <tr><th class="field_label "
    id="field_label_version">


  <a 
      title="The version field defines the version of the software the bug was found in."
      class="field_help_link"
      href="page.cgi?id=fields.html#version"
  >Version:</a>

</th>

      <td>3.0 &#160; <a href="https://dev.eclipse.org/committers/bugs/bugz_manager.php"><img src="//dev.eclipse.org/small_icons/apps/accessories-text-editor.png" alt="Edit" title="Edit these values" /></a></td>
    </tr>
        
    
        
    <tr><th class="field_label "
    id="field_label_rep_platform">


  <a 
      title="The hardware platform the bug was observed on. Note: When searching, selecting the option &quot;All&quot; only finds bugs whose value for this field is literally the word &quot;All&quot;."
      class="field_help_link"
      href="page.cgi?id=fields.html#rep_platform"
  >Hardware:</a>

</th>
      <td class="field_value">PC
        Windows All
      </td>
    </tr>
          <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
          
          <tr>
      <th class="field_label">
        <label  accesskey="i">
          <a href="page.cgi?id=fields.html#importance"><u>I</u>mportance</a></label>:
      </th>
      <td>P3
       normal<span id="votes_container">
      with
      <a href="page.cgi?id=voting/bug.html&amp;bug_id=113675">13 
            votes</a>
    (<a href="page.cgi?id=voting/user.html&amp;bug_id=113675#vote_113675">vote</a>)
  </span>
      </td>
    </tr>

      <tr><th class="field_label "
    id="field_label_target_milestone">


  <a 
      title="The Target Milestone field is used to define when the engineer the bug is assigned to expects to fix it."
      class="field_help_link"
      href="page.cgi?id=fields.html#target_milestone"
  >Target Milestone:</a>

</th>
        <td>--- &#160; <a href="https://dev.eclipse.org/committers/bugs/bugz_manager.php"><img src="//dev.eclipse.org/small_icons/apps/accessories-text-editor.png" alt="Edit" title="Edit these values" /></a></td>
      </tr>
          
          <tr><th class="field_label "
    id="field_label_assigned_to">


  <a 
      title="The person in charge of resolving the bug."
      class="field_help_link"
      href="page.cgi?id=fields.html#assigned_to"
  >Assignee:</a>

</th>
      <td><span class="vcard"><span class="fn">Platform UI Triaged</span> <a href="http://wiki.eclipse.org/ECA"><img class="cla_dec" src="https://accounts.eclipse.org/user/eca/badge?mail=platform-ui-triaged&#64;eclipse.org" alt="CLA" title="Eclipse Contributor Agreement" /></a> <a href="https://eclipse.org/donate/"><img class="cla_dec" src="//www.eclipse.org/donate/web-api/friends_decorator.php?email=platform-ui-triaged&#64;eclipse.org" alt="Friend" title="Friend of Eclipse" /></a>
</span>
      </td>
    </tr>

    <tr><th class="field_label "
    id="field_label_qa_contact">


  <a 
      title="The person responsible for confirming this bug if it is unconfirmed, and for verifying the fix once the bug has been resolved."
      class="field_help_link"
      href="page.cgi?id=fields.html#qa_contact"
  >QA Contact:</a>

</th>
      <td><span class="vcard">
</span>
      </td>
    </tr>
    <script type="text/javascript">
      assignToDefaultOnChange(['product', 'component'],
        'Platform-UI-Inbox\x40eclipse.org',
        '');
    </script>
          <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
          <tr><th class="field_label "
    id="field_label_bug_file_loc">


  <a 
      title="Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen."
      class="field_help_link"
      href="page.cgi?id=fields.html#bug_file_loc"
  >URL:</a>

</th>
    <td>
      <span id="bz_url_input_area">
      </span>
    </td>
  </tr>

    <tr><th class="field_label "
    id="field_label_status_whiteboard">


  <a 
      title="Each bug has a free-form single line text entry box for adding tags and status information."
      class="field_help_link"
      href="page.cgi?id=fields.html#status_whiteboard"
  >Whiteboard:</a>

</th><td>stalebug  
  </td>
    </tr>

    <tr><th class="field_label "
    id="field_label_keywords">


  <a 
      title="You can add keywords from a defined list to bugs, in order to easily identify and group them."
      class="field_help_link"
      href="describekeywords.cgi"
  >Keywords:</a>

</th>
  <td class="field_value "
      id="field_container_keywords" >helpwanted

</td>
    </tr>
          <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>

          <tr>
    <th class="field_label">
      <label>Duplicates (3)</label>:
    </th>
    <td class="field_value">
      <span id="duplicates"><a class="bz_bug_link 
          bz_status_RESOLVED  bz_closed"
   title="RESOLVED DUPLICATE - [Viewers] JFace tree viewer collapses tree items on refresh"
   href="show_bug.cgi?id=35586">35586</a> <a class="bz_bug_link 
          bz_status_RESOLVED  bz_closed"
   title="RESOLVED DUPLICATE - [Viewers] Tree expansion state not maintained"
   href="show_bug.cgi?id=64140">64140</a> <a class="bz_bug_link 
          bz_status_RESOLVED  bz_closed"
   title="RESOLVED DUPLICATE - [Viewers] TreeViewer loses expansion state when refresh needs to create new item for existing element"
   href="show_bug.cgi?id=227800">227800</a> 
      </span>
      (<a href="buglist.cgi?bug_id=35586,64140,227800">view as bug list</a>)
    </td>
  </tr>
<tr><th class="field_label "
    id="field_label_dependson">


  <a 
      title="The bugs listed here must be resolved before this bug can be resolved."
      class="field_help_link"
      href="page.cgi?id=fields.html#dependson"
  >Depends on:</a>

</th>

  <td>
    <span id="dependson_input_area">
    </span>

  </td>
  </tr>
  
  <tr><th class="field_label "
    id="field_label_blocked">


  <a 
      title="This bug must be resolved before the bugs listed in this field can be resolved."
      class="field_help_link"
      href="page.cgi?id=fields.html#blocked"
  >Blocks:</a>

</th>

  <td>
    <span id="blocked_input_area">
    </span>
<a class="bz_bug_link 
          bz_status_CLOSED  bz_closed"
   title="CLOSED WONTFIX - [Change Sets] Adding a changed file to a changeset collapses part of the Tree"
   href="show_bug.cgi?id=185907">185907</a> 
  </td>
  </tr>

    <tr>
      <th>&nbsp;</th>

      <td id="show_dependency_tree_or_graph">
        Show dependency <a href="showdependencytree.cgi?id=113675&amp;hide_resolved=1">tree</a>

      </td>
    </tr>
          
        </table>
      </td>
      <td>
        <div class="bz_column_spacer">&nbsp;</div>
      </td>
      
      <td id="bz_show_bug_column_2" class="bz_show_bug_column">
        <table>
        <tr>
    <th class="field_label">
      Reported:
    </th>
    <td>2005-10-25 11:48 EDT by <span class="vcard"><span class="fn">Ashish Patel</span> <a href="http://wiki.eclipse.org/ECA"><img class="cla_dec" src="https://accounts.eclipse.org/user/eca/badge?mail=ashishp&#64;ca.ibm.com" alt="CLA" title="Eclipse Contributor Agreement" /></a> <a href="https://eclipse.org/donate/"><img class="cla_dec" src="//www.eclipse.org/donate/web-api/friends_decorator.php?email=ashishp&#64;ca.ibm.com" alt="Friend" title="Friend of Eclipse" /></a>
</span>
    </td>
  </tr>
  
  <tr>
    <th class="field_label">
      Modified:
    </th>
    <td>2020-07-23 19:15 EDT
      (<a href="show_activity.cgi?id=113675">History</a>)
    </td>
  
  </tr>
<tr>
      <th class="field_label">
        <label  accesskey="a">
          CC List:
        </label>
      </th>
      <td>26 
          users
          <span id="cc_edit_area_showhide_container" class="bz_default_hidden">
            (<a href="#" id="cc_edit_area_showhide">show</a>)
          </span>
        <div id="cc_edit_area">
          <br>
            <select id="cc" multiple="multiple" size="5" >
                <option value="adrijukas">adrijukas</option>
                <option value="aplante">aplante</option>
                <option value="apnan">apnan</option>
                <option value="badii.bayoudh">badii.bayoudh</option>
                <option value="bpasero">bpasero</option>
                <option value="cgross">cgross</option>
                <option value="christophe.cornu+eclipse">christophe.cornu+eclipse</option>
                <option value="dbaumann">dbaumann</option>
                <option value="dominik.stadler">dominik.stadler</option>
                <option value="fmorshed">fmorshed</option>
                <option value="hudsonr">hudsonr</option>
                <option value="jason.roberts">jason.roberts</option>
                <option value="markus.kell.r">markus.kell.r</option>
                <option value="mjgibso">mjgibso</option>
                <option value="mlists">mlists</option>
                <option value="n.a.edgar">n.a.edgar</option>
                <option value="ovidr">ovidr</option>
                <option value="phil_fj12">phil_fj12</option>
                <option value="sebastian.ratz">sebastian.ratz</option>
                <option value="shashwat.work">shashwat.work</option>
                <option value="shr31223">shr31223</option>
                <option value="spacehorst">spacehorst</option>
                <option value="tom.schindl">tom.schindl</option>
                <option value="veronika_irvine">veronika_irvine</option>
                <option value="walther">walther</option>
                <option value="wuppiwuppi">wuppiwuppi</option>
            </select>
        </div>
          <script type="text/javascript">
            hideEditableField( 'cc_edit_area_showhide_container', 
                               'cc_edit_area', 
                               'cc_edit_area_showhide', 
                               '', 
                               '');  
          </script>
      </td>
    </tr>

<tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
<tr><th class="field_label "
    id="field_label_see_also">


  <a 
      title="This allows you to refer to bugs in other installations. You can enter a URL to a bug in the 'Add Bug URLs' field to note that that bug is related to this one. You can enter multiple URLs at once by separating them with whitespace. You should normally use this field to refer to bugs in other installations. For bugs in this installation, it is better to use the Depends on and Blocks fields."
      class="field_help_link"
      href="page.cgi?id=fields.html#see_also"
  >See Also:</a>

</th>
  <td class="field_value "
      id="field_container_see_also" >

</td>
    </tr> 

<tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>



        </table>
      </td>
    </tr>
    <tr>
      <td colspan="3">
          <hr id="bz_top_half_spacer">
      </td>
    </tr>
  </table>

  <table id="bz_big_form_parts">
  <tr>
  <td>

    
<script type="text/javascript">
<!--
function toggle_display(link) {
    var table = document.getElementById("attachment_table");
    var view_all = document.getElementById("view_all");
    var hide_obsolete_url_parameter = "&hide_obsolete=1";
    // Store current height for scrolling later
    var originalHeight = table.offsetHeight;
    var rows = YAHOO.util.Dom.getElementsByClassName(
        'bz_tr_obsolete', 'tr', table);

    for (var i = 0; i < rows.length; i++) {
        bz_toggleClass(rows[i], 'bz_default_hidden');
    }

    if (YAHOO.util.Dom.hasClass(rows[0], 'bz_default_hidden')) {
        link.innerHTML = "Show Obsolete";
        view_all.href = view_all.href + hide_obsolete_url_parameter 
    }
    else {
        link.innerHTML = "Hide Obsolete";
        view_all.href = view_all.href.replace(hide_obsolete_url_parameter,"");
    }

    var newHeight = table.offsetHeight;
    // This scrolling makes the window appear to not move at all.
    window.scrollBy(0, newHeight - originalHeight);

    return false;
}
//-->
</script>

<br>
<table id="attachment_table">
  <tr id="a0">
    <th colspan="3" class="left">
      Attachments
    </th>
  </tr>


      <tr id="a1" class="bz_contenttype_application_octet-stream">
        <td>
            <a href="attachment.cgi?id=83448"
               title="View the content of the attachment">
          <b>Sample to demonstrate the collapsing of nodes on a sort</b></a>

          <span class="bz_attach_extra_info">
              (10.61 KB,
                application/octet-stream)

            <br>
            <a href="#attach_83448"
               title="Go to the comment associated with the attachment">2007-11-21 12:33 EST</a>,

            <span class="vcard"><span class="fn">Alan Plante</span> <a href="http://wiki.eclipse.org/ECA"><img class="cla_dec" src="https://accounts.eclipse.org/user/eca/badge?mail=aplante&#64;us.ibm.com" alt="CLA" title="Eclipse Contributor Agreement" /></a> <a href="https://eclipse.org/donate/"><img class="cla_dec" src="//www.eclipse.org/donate/web-api/friends_decorator.php?email=aplante&#64;us.ibm.com" alt="Friend" title="Friend of Eclipse" /></a>
</span>
          </span>
        </td>

          <td class="bz_attach_flags">
              <i>no flags</i>
          </td>

        <td>
          <a href="attachment.cgi?id=83448&amp;action=edit">Details</a>
        </td>
      </tr>
      <tr id="a2" class="bz_contenttype_text_plain bz_patch">
        <td>
            <a href="attachment.cgi?id=123785"
               title="View the content of the attachment">
          <b>potential solution (untested)</b></a>

          <span class="bz_attach_extra_info">
              (2.57 KB,
                patch)

            <br>
            <a href="#attach_123785"
               title="Go to the comment associated with the attachment">2009-01-26 13:27 EST</a>,

            <span class="vcard"><span class="fn">Boris Bokowski</span> <a href="http://wiki.eclipse.org/ECA"><img class="cla_dec" src="https://accounts.eclipse.org/user/eca/badge?mail=bokowski&#64;google.com" alt="CLA" title="Eclipse Contributor Agreement" /></a> <a href="https://eclipse.org/donate/"><img class="cla_dec" src="//www.eclipse.org/donate/web-api/friends_decorator.php?email=bokowski&#64;google.com" alt="Friend" title="Friend of Eclipse" /></a>
</span>
          </span>
        </td>

          <td class="bz_attach_flags">
              <i>no flags</i>
          </td>

        <td>
          <a href="attachment.cgi?id=123785&amp;action=edit">Details</a>
            | <a href="attachment.cgi?id=123785&amp;action=diff">Diff</a>
        </td>
      </tr>
      <tr id="a3" class="bz_contenttype_application_octet-stream">
        <td>
            <a href="attachment.cgi?id=164351"
               title="View the content of the attachment">
          <b>Simple snippet to reproduce the tree viewer bug </b></a>

          <span class="bz_attach_extra_info">
              (4.48 KB,
                application/octet-stream)

            <br>
            <a href="#attach_164351"
               title="Go to the comment associated with the attachment">2010-04-09 06:21 EDT</a>,

            <span class="vcard"><span class="fn">Dirk Baumann</span> <a href="http://wiki.eclipse.org/ECA"><img class="cla_dec" src="https://accounts.eclipse.org/user/eca/badge?mail=dbaumann&#64;csc.com" alt="CLA" title="Eclipse Contributor Agreement" /></a> <a href="https://eclipse.org/donate/"><img class="cla_dec" src="//www.eclipse.org/donate/web-api/friends_decorator.php?email=dbaumann&#64;csc.com" alt="Friend" title="Friend of Eclipse" /></a>
</span>
          </span>
        </td>

          <td class="bz_attach_flags">
              <i>no flags</i>
          </td>

        <td>
          <a href="attachment.cgi?id=164351&amp;action=edit">Details</a>
        </td>
      </tr>

  <tr class="bz_attach_footer">
    <td colspan="3">
        <span class="bz_attach_view_hide">
            <a id="view_all" href="attachment.cgi?bugid=113675&amp;action=viewall">View All</a>
        </span>
        <a href="attachment.cgi?bugid=113675&amp;action=enter">Add an attachment</a>
        (proposed patch, testcase, etc.)
    </td>
  </tr>
</table>
<br>
<div id="add_comment" class="bz_section_additional_comments">
      <table>
        <tr>
          <td>
            <fieldset>
              <legend>Note</legend>
              You need to
              <a href="show_bug.cgi?id=113675&amp;GoAheadAndLogIn=1">log in</a>
              before you can comment on or make changes to this bug.
            </fieldset>
          </td>
        </tr> 
      </table>
  </div>
  </td>
  <td>
  </td>
  </tr></table>

  
  <div id="comments"><script src="https://bugs.eclipse.org/bugs/js/comments.js?1463425338" type="text/javascript">
</script>

<script type="text/javascript">
<!--
  /* Adds the reply text to the 'comment' textarea */
  function replyToComment(id, real_id, name) {
      var prefix = "(In reply to " + name + " from comment #" + id + ")\n";
      var replytext = "";
        /* pre id="comment_name_N" */
        var text_elem = document.getElementById('comment_text_'+id);
        var text = getText(text_elem);
        replytext = prefix + wrapReplyText(text);


      /* <textarea id="comment"> */
      var textarea = document.getElementById('comment');
      if (textarea.value != replytext) {
          textarea.value += replytext;
      }

      textarea.focus();
  } 
//-->
</script>


<!-- This auto-sizes the comments and positions the collapse/expand links 
     to the right. -->
<table class="bz_comment_table">
<tr>
<td>
<div id="c0" class="bz_comment bz_first_comment">

      <div class="bz_first_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=113675#c0">Description</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Ashish Patel</span> <a href="http://wiki.eclipse.org/ECA"><img class="cla_dec" src="https://accounts.eclipse.org/user/eca/badge?mail=ashishp&#64;ca.ibm.com" alt="CLA" title="Eclipse Contributor Agreement" /></a> <a href="https://eclipse.org/donate/"><img class="cla_dec" src="//www.eclipse.org/donate/web-api/friends_decorator.php?email=ashishp&#64;ca.ibm.com" alt="Friend" title="Friend of Eclipse" /></a>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2005-10-25 11:48:00 EDT
        </span>

      </div>




<pre class="bz_comment_text">I currently am using the TableTree that has a 5-level deep tree.  I use a
ViewerSorter to sort the elements based on simple compare routines.

However, when I expand and collapse any particular set of nodes to arbitary
depths and then sort on the column the nodes that I selected to be
expanded/collapsed all collapse up.  Note that the order of the items in the
tree after this occurs is correctly sorted.

Example:

A) here is an tree that is fully expanded (by the user's mouse clicks)

- B
  + B(1)
- A
  - A(1)
     - A(1)(1)
       + A(1)(3)
     + A(1)(2)

B) now I sort on a column and I get

- A
  + A(1)
- B
  + B(1)

Notice that the order is correctly sorted (A before B) and the child elements of
A(1) are now all collpased when they were explicitly expanded by the user before
sorting.

Here is an example of what I'm doing (I'm hoping you can see that I'm not
explicitly controlling the expanding/collapsing of the nodes.  I simply refresh
the view):

1) I create a selection listener for the column to sort on

   _column.addSelectionListener(new SelectionListener() {

	public void widgetSelected(SelectionEvent e) {
		if (e.widget instanceof TreeColumn) {
			_columnSelection = getIndexOfSelectedColumn();
			_treeViewer.getControl.setRedraw(false);
			_treeViewer.refresh();
			_treeViewer.getControl.setRedraw(true);
		}

		public void widgetDefaultSelected(SelectionEvent e) {
			widgetSelected(e);
		}
	});

2) My ViewerSorter class is coded similar to:

_treeViewer.setSorter(new ViewerSorter() {
      public int compare(Viewer viewer, Object e1, Object e2) {
	switch (_columnSelection) {
	case 1:
		return compareStrings(e1,e2);
	case 2:
		return compareInts(e1,e2);
	}
	return 0;
});</pre>
    </div>

    <div id="c1" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=113675#c1">Comment 1</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Veronika Irvine</span> <a href="http://wiki.eclipse.org/ECA"><img class="cla_dec" src="https://accounts.eclipse.org/user/eca/badge?mail=veronika_irvine&#64;yahoo.com" alt="CLA" title="Eclipse Contributor Agreement" /></a> <a href="https://eclipse.org/donate/"><img class="cla_dec" src="//www.eclipse.org/donate/web-api/friends_decorator.php?email=veronika_irvine&#64;yahoo.com" alt="Friend" title="Friend of Eclipse" /></a>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2005-10-27 08:45:40 EDT
        </span>

      </div>




<pre class="bz_comment_text">TreeViewer is a JFace component - moving to the UI team.</pre>
    </div>

    <div id="c2" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=113675#c2">Comment 2</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Boris Bokowski</span> <a href="http://wiki.eclipse.org/ECA"><img class="cla_dec" src="https://accounts.eclipse.org/user/eca/badge?mail=bokowski&#64;google.com" alt="CLA" title="Eclipse Contributor Agreement" /></a> <a href="https://eclipse.org/donate/"><img class="cla_dec" src="//www.eclipse.org/donate/web-api/friends_decorator.php?email=bokowski&#64;google.com" alt="Friend" title="Friend of Eclipse" /></a>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2005-11-03 10:12:10 EST
        </span>

      </div>




<pre class="bz_comment_text">I can give this a try for 3.2 M4.  Since this seems to be a major problem for
you, would you be able to contribute a JUnit test for it?</pre>
    </div>

    <div id="c3" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=113675#c3">Comment 3</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Ashish Patel</span> <a href="http://wiki.eclipse.org/ECA"><img class="cla_dec" src="https://accounts.eclipse.org/user/eca/badge?mail=ashishp&#64;ca.ibm.com" alt="CLA" title="Eclipse Contributor Agreement" /></a> <a href="https://eclipse.org/donate/"><img class="cla_dec" src="//www.eclipse.org/donate/web-api/friends_decorator.php?email=ashishp&#64;ca.ibm.com" alt="Friend" title="Friend of Eclipse" /></a>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2005-11-03 10:21:34 EST
        </span>

      </div>




<pre class="bz_comment_text">I don't think that will be a problem.

I think the first thing you should try is to recreate my problem with the
current TreeViewer in Eclipse 3.1 (to verify that this is indeed a bug).  If it
is then I'll work on a JUnit.

</pre>
    </div>

    <div id="c4" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=113675#c4">Comment 4</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Veronika Irvine</span> <a href="http://wiki.eclipse.org/ECA"><img class="cla_dec" src="https://accounts.eclipse.org/user/eca/badge?mail=veronika_irvine&#64;yahoo.com" alt="CLA" title="Eclipse Contributor Agreement" /></a> <a href="https://eclipse.org/donate/"><img class="cla_dec" src="//www.eclipse.org/donate/web-api/friends_decorator.php?email=veronika_irvine&#64;yahoo.com" alt="Friend" title="Friend of Eclipse" /></a>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2005-11-03 11:13:11 EST
        </span>

      </div>




<pre class="bz_comment_text">Note that TableTree is deprecated.  You should probably first verify that the 
same problem occurs with a Tree and TreeColumns.</pre>
    </div>

    <div id="c5" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=113675#c5">Comment 5</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Ashish Patel</span> <a href="http://wiki.eclipse.org/ECA"><img class="cla_dec" src="https://accounts.eclipse.org/user/eca/badge?mail=ashishp&#64;ca.ibm.com" alt="CLA" title="Eclipse Contributor Agreement" /></a> <a href="https://eclipse.org/donate/"><img class="cla_dec" src="//www.eclipse.org/donate/web-api/friends_decorator.php?email=ashishp&#64;ca.ibm.com" alt="Friend" title="Friend of Eclipse" /></a>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2005-11-04 10:23:44 EST
        </span>

      </div>




<pre class="bz_comment_text">You will also want to look at the TreeEditor and TreeEditorImpl (as these help
construct the TreeViewer as a Viewer.  I suspect the problem isn't in the
TreeColumns class (just guessing) because this is a sorting problem of the tree
nodes would logically be in the component that executes the reordering of the
tree nodes.  I suspect its in Tree or the TreeEditor.

</pre>
    </div>

    <div id="c6" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=113675#c6">Comment 6</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Ashish Patel</span> <a href="http://wiki.eclipse.org/ECA"><img class="cla_dec" src="https://accounts.eclipse.org/user/eca/badge?mail=ashishp&#64;ca.ibm.com" alt="CLA" title="Eclipse Contributor Agreement" /></a> <a href="https://eclipse.org/donate/"><img class="cla_dec" src="//www.eclipse.org/donate/web-api/friends_decorator.php?email=ashishp&#64;ca.ibm.com" alt="Friend" title="Friend of Eclipse" /></a>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2005-11-25 11:25:18 EST
        </span>

      </div>




<pre class="bz_comment_text">Did some more digging and here is what I found using my initial example:

- B
  + B(1)
- A
  - A(1)
     - A(1)(1)
       + A(1)(3)
     + A(1)(2)

When you click on a column to sort, my sorter class (which is an extension of ViewerSorter) has a compare() method that is only being called for the &quot;root&quot; elements in my tree - that is &quot;A&quot; and &quot;B&quot; above.  During this same sorting session, the compare() method is not being called for any &quot;child nodes&quot;.  That is there is no call being made to compare() for  &quot;A(1)(1)&quot; and &quot;A(1)(2)&quot; during the same sorting session.  

I think the ViewerSorter should be handling recursively calling the compare() method for child nodes after the root nodes in the tree are sorted.</pre>
    </div>

    <div id="c7" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=113675#c7">Comment 7</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Ashish Patel</span> <a href="http://wiki.eclipse.org/ECA"><img class="cla_dec" src="https://accounts.eclipse.org/user/eca/badge?mail=ashishp&#64;ca.ibm.com" alt="CLA" title="Eclipse Contributor Agreement" /></a> <a href="https://eclipse.org/donate/"><img class="cla_dec" src="//www.eclipse.org/donate/web-api/friends_decorator.php?email=ashishp&#64;ca.ibm.com" alt="Friend" title="Friend of Eclipse" /></a>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2005-11-25 11:29:26 EST
        </span>

      </div>




<pre class="bz_comment_text">I would like to elaborate and say that compare() is called for the child nodes when you click the &quot;expand&quot; button on the tree, however it is not called for the child nodes with you click on the column for sorting.  

In addition, this may also explaing why the tree collapses itself back up to the root level showing only 1 immediate child level and not any deeper (refer to the initial example I posted).  I leave it up to you to verify.</pre>
    </div>

    <div id="c8" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=113675#c8">Comment 8</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Boris Bokowski</span> <a href="http://wiki.eclipse.org/ECA"><img class="cla_dec" src="https://accounts.eclipse.org/user/eca/badge?mail=bokowski&#64;google.com" alt="CLA" title="Eclipse Contributor Agreement" /></a> <a href="https://eclipse.org/donate/"><img class="cla_dec" src="//www.eclipse.org/donate/web-api/friends_decorator.php?email=bokowski&#64;google.com" alt="Friend" title="Friend of Eclipse" /></a>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2005-12-15 14:01:21 EST
        </span>

      </div>




<pre class="bz_comment_text">This is still a bug in the current code (TreeViewer). Moving to M5 for fixing.

Ashish, a test case would be very much appreciated, preferably in the form of a new method for AbstractTreeViewerTest.</pre>
    </div>

    <div id="c9" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=113675#c9">Comment 9</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Ashish Patel</span> <a href="http://wiki.eclipse.org/ECA"><img class="cla_dec" src="https://accounts.eclipse.org/user/eca/badge?mail=ashishp&#64;ca.ibm.com" alt="CLA" title="Eclipse Contributor Agreement" /></a> <a href="https://eclipse.org/donate/"><img class="cla_dec" src="//www.eclipse.org/donate/web-api/friends_decorator.php?email=ashishp&#64;ca.ibm.com" alt="Friend" title="Friend of Eclipse" /></a>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2006-01-20 15:20:52 EST
        </span>

      </div>




<pre class="bz_comment_text">I've taken a look at the AbstractTreeViewerTest class where you keep your current tests for this widget.  However, I find if very difficult and complex to write a test case that sorts a sufficient sample data and verify that the sorting has worked correctly.

The easiest way to verify the changes is to load a sample data set into the table then sort by clicking a column and visually verifying that the sort has worked. I say its quite complex to do this programmatically in the Junit test because the sample data set could be 5-8 levels deep.  In addition, there are known problems with GTK to read values back out from the table during the verification process.

A sufficient sample data set includes a tree that is 5-8 levels deep where the TreeViewer has 4-5 columns of data across these 5-8 levels in the tree.  A smaller example of what I'm talking about is shown below:

Column 1               Column 2        Column 3      Column 4
- B                    16.00           8.00          4.000
  + B(1)               8.00            4.00          2.000
  + B(1)               8.00            4.00          2.000
- A                    16.00           8.00          4.000
  - A(1)               16.00           8.00          4.000
     - A(1)(1)         8.00            4.00          2.000
       + A(1)(3)       4.00            2.00          1.000
       + A(1)(3)       4.00            2.00          1.000
     + A(1)(2)         8.00            4.00          2.000

Notice that the values (in columns 2-4) of the child elements add up to the values(in columns 2-4) in the parent elements.  Sorting on columns 2-4 should order the tree elements appropriately and preserve the tree structure (that is sort the parent tree element first then its children).

Therefore, I don't a Junit test is the best way to verify this defect.  I think one must manually do this.  My suggestion is for you to actually use the TreeViewer and create a testing application that loads the data and sorts it - and visually verify it.  Does anyone have opinions/comments on this?

I have an application with valid data samples ready that prove the sorting to fail, so if you develop a patch that I can load into the workbench, I'd be glad to tell you if the fixes work or not.</pre>
    </div>

    <div id="c10" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=113675#c10">Comment 10</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Boris Bokowski</span> <a href="http://wiki.eclipse.org/ECA"><img class="cla_dec" src="https://accounts.eclipse.org/user/eca/badge?mail=bokowski&#64;google.com" alt="CLA" title="Eclipse Contributor Agreement" /></a> <a href="https://eclipse.org/donate/"><img class="cla_dec" src="//www.eclipse.org/donate/web-api/friends_decorator.php?email=bokowski&#64;google.com" alt="Friend" title="Friend of Eclipse" /></a>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2006-01-23 17:36:20 EST
        </span>

      </div>




<pre class="bz_comment_text">Finally, we figured out what causes the problem:

When TreeViewer does a refresh(), it reuses the existing TreeItems where possible, but it also disposes of invisible tree items that might exist as children of a collapsed node. Expansion state is only remembered for children of one parent while its children are being recomputed. As a result, there are cases where the expansion state of tree items deeper in the tree are lost.

We need to remember the complete expansion state to fix this bug. One way of doing this would be to change preservingSelection() to preservingSelectionAndExpansion().</pre>
    </div>

    <div id="c11" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=113675#c11">Comment 11</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Ashish Patel</span> <a href="http://wiki.eclipse.org/ECA"><img class="cla_dec" src="https://accounts.eclipse.org/user/eca/badge?mail=ashishp&#64;ca.ibm.com" alt="CLA" title="Eclipse Contributor Agreement" /></a> <a href="https://eclipse.org/donate/"><img class="cla_dec" src="//www.eclipse.org/donate/web-api/friends_decorator.php?email=ashishp&#64;ca.ibm.com" alt="Friend" title="Friend of Eclipse" /></a>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2006-01-24 08:42:54 EST
        </span>

      </div>




<pre class="bz_comment_text">This issue is now fixed.  For the record, there was no problem with the actual TreeViewer implementation.  I wrote a test called TreeViewerAdvancedTest in org.eclipse.ui.tests that goes to verify that the sorting capability for deep trees works (Boris may commit this if he feels its necessary).  The problem was in my code that was using the TreeViewer class.

The problem of sorting was fixed using two fixes:

1)  Before the TreeViewer.refresh() was called when the sorting process starts, the expanded elements were cached, and restored following the refresh:

Object[] expandedElements = _treeViewer.getExpandedElements();
_treeViewer.refresh();
_treeViewer.setExpandedElements(expandedElements);

2) The data objects being stored for each TreeItem (TreeItem.setData()) did not have proper hashCode() methods implemented.  Therefore, when the sorting occured the TreeItem nodes that were expanded before the sorting couldn't properly be found after the sorting.  

Both of these fixes failed in the TreeViewer's attempt to retaun the visual display of the expanded elements would fail and all the tree nodes would collapse on itself.</pre>
    </div>

    <div id="c12" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=113675#c12">Comment 12</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Boris Bokowski</span> <a href="http://wiki.eclipse.org/ECA"><img class="cla_dec" src="https://accounts.eclipse.org/user/eca/badge?mail=bokowski&#64;google.com" alt="CLA" title="Eclipse Contributor Agreement" /></a> <a href="https://eclipse.org/donate/"><img class="cla_dec" src="//www.eclipse.org/donate/web-api/friends_decorator.php?email=bokowski&#64;google.com" alt="Friend" title="Friend of Eclipse" /></a>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2006-01-24 08:58:30 EST
        </span>

      </div>




<pre class="bz_comment_text">I'm reopening this because I think that TreeViewer should try to retain the expanded state of elements when refreshing. In other words, clients should not have to remember the expanded state before calling refresh() in order to restore it later.

I'm downgrading to normal, and removing the target milestone because this is only a problem in deep trees that are partially expanded, and a workaround exists.</pre>
    </div>

    <div id="c13" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=113675#c13">Comment 13</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Boris Bokowski</span> <a href="http://wiki.eclipse.org/ECA"><img class="cla_dec" src="https://accounts.eclipse.org/user/eca/badge?mail=bokowski&#64;google.com" alt="CLA" title="Eclipse Contributor Agreement" /></a> <a href="https://eclipse.org/donate/"><img class="cla_dec" src="//www.eclipse.org/donate/web-api/friends_decorator.php?email=bokowski&#64;google.com" alt="Friend" title="Friend of Eclipse" /></a>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2007-05-30 09:21:19 EDT
        </span>

      </div>




<pre class="bz_comment_text">*** <a class="bz_bug_link 
          bz_status_RESOLVED  bz_closed"
   title="RESOLVED DUPLICATE - [Viewers] Tree expansion state not maintained"
   href="show_bug.cgi?id=64140">Bug 64140</a> has been marked as a duplicate of this bug. ***</pre>
    </div>

    <div id="c14" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=113675#c14">Comment 14</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Randy Hudson</span> <a href="http://wiki.eclipse.org/ECA"><img class="cla_dec" src="https://accounts.eclipse.org/user/eca/badge?mail=hudsonr&#64;us.ibm.com" alt="CLA" title="Eclipse Contributor Agreement" /></a> <a href="https://eclipse.org/donate/"><img class="cla_dec" src="//www.eclipse.org/donate/web-api/friends_decorator.php?email=hudsonr&#64;us.ibm.com" alt="Friend" title="Friend of Eclipse" /></a>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2007-05-30 10:46:55 EDT
        </span>

      </div>




<pre class="bz_comment_text"><span class="quote">&gt; I'm downgrading to normal, and removing the target milestone because this is
&gt; only a problem in deep trees that are partially expanded, and a workaround
&gt; exists.</span >

A tree with only 3 levels is considered deep? This problem affects team synchronize views very often, since incoming and outgoing changes are constantly changing.

If one uses the workaround, is it also necessary to disable redraw to prevent the platform's native animation?</pre>
    </div>

    <div id="c15" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=113675#c15">Comment 15</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Boris Bokowski</span> <a href="http://wiki.eclipse.org/ECA"><img class="cla_dec" src="https://accounts.eclipse.org/user/eca/badge?mail=bokowski&#64;google.com" alt="CLA" title="Eclipse Contributor Agreement" /></a> <a href="https://eclipse.org/donate/"><img class="cla_dec" src="//www.eclipse.org/donate/web-api/friends_decorator.php?email=bokowski&#64;google.com" alt="Friend" title="Friend of Eclipse" /></a>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2007-05-30 11:04:48 EDT
        </span>

      </div>




<pre class="bz_comment_text">(In reply to <a href="show_bug.cgi?id=113675#c14">comment #14</a>)
<span class="quote">&gt; If one uses the workaround, is it also necessary to disable redraw to prevent
&gt; the platform's native animation?</span >

Good question. I don't know.

I agree that reusing tree items creates problems.  Obviously, it is too late to
do anything about this in 3.3 given how late we are in the development cycle. 
I can mark this as 3.4 to make sure it appears on my radar again but cannot
promise that we will have the time to fix it.</pre>
    </div>

    <div id="c16" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=113675#c16">Comment 16</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Randy Hudson</span> <a href="http://wiki.eclipse.org/ECA"><img class="cla_dec" src="https://accounts.eclipse.org/user/eca/badge?mail=hudsonr&#64;us.ibm.com" alt="CLA" title="Eclipse Contributor Agreement" /></a> <a href="https://eclipse.org/donate/"><img class="cla_dec" src="//www.eclipse.org/donate/web-api/friends_decorator.php?email=hudsonr&#64;us.ibm.com" alt="Friend" title="Friend of Eclipse" /></a>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2007-05-30 11:43:33 EDT
        </span>

      </div>




<pre class="bz_comment_text">Why wouldn't this be a candidate for maintenance?</pre>
    </div>

    <div id="c17" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=113675#c17">Comment 17</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Boris Bokowski</span> <a href="http://wiki.eclipse.org/ECA"><img class="cla_dec" src="https://accounts.eclipse.org/user/eca/badge?mail=bokowski&#64;google.com" alt="CLA" title="Eclipse Contributor Agreement" /></a> <a href="https://eclipse.org/donate/"><img class="cla_dec" src="//www.eclipse.org/donate/web-api/friends_decorator.php?email=bokowski&#64;google.com" alt="Friend" title="Friend of Eclipse" /></a>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2007-06-07 10:48:53 EDT
        </span>

      </div>




<pre class="bz_comment_text">(In reply to <a href="show_bug.cgi?id=113675#c16">comment #16</a>)
<span class="quote">&gt; Why wouldn't this be a candidate for maintenance?</span >

I am reluctant to fix this in a maintenance release because we only do limited testing for them, and changing this seems non-trivial to me and might even require new API.</pre>
    </div>

    <div id="c18" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=113675#c18">Comment 18</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Boris Bokowski</span> <a href="http://wiki.eclipse.org/ECA"><img class="cla_dec" src="https://accounts.eclipse.org/user/eca/badge?mail=bokowski&#64;google.com" alt="CLA" title="Eclipse Contributor Agreement" /></a> <a href="https://eclipse.org/donate/"><img class="cla_dec" src="//www.eclipse.org/donate/web-api/friends_decorator.php?email=bokowski&#64;google.com" alt="Friend" title="Friend of Eclipse" /></a>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2007-06-19 15:21:50 EDT
        </span>

      </div>




<pre class="bz_comment_text">*** <a class="bz_bug_link 
          bz_status_RESOLVED  bz_closed"
   title="RESOLVED DUPLICATE - [Viewers] JFace tree viewer collapses tree items on refresh"
   href="show_bug.cgi?id=35586">Bug 35586</a> has been marked as a duplicate of this bug. ***</pre>
    </div>

    <div id="c19" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=113675#c19">Comment 19</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Alan Plante</span> <a href="http://wiki.eclipse.org/ECA"><img class="cla_dec" src="https://accounts.eclipse.org/user/eca/badge?mail=aplante&#64;us.ibm.com" alt="CLA" title="Eclipse Contributor Agreement" /></a> <a href="https://eclipse.org/donate/"><img class="cla_dec" src="//www.eclipse.org/donate/web-api/friends_decorator.php?email=aplante&#64;us.ibm.com" alt="Friend" title="Friend of Eclipse" /></a>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2007-11-21 12:33:12 EST
        </span>

      </div>




<pre class="bz_comment_text">Created <span class=""><a href="attachment.cgi?id=83448" name="attach_83448" title="Sample to demonstrate the collapsing of nodes on a sort">attachment 83448</a> <a href="attachment.cgi?id=83448&amp;action=edit" title="Sample to demonstrate the collapsing of nodes on a sort">[details]</a></span>
Sample to demonstrate the collapsing of nodes on a sort

Demonstrates a sorting issue in the viewer:
1. Expand all elements:
  Schema
       DB1
       DB2
           T1
           T2
               C1
               C2
               C3
  2. Sort by the Status column
   Schema
       DB1
       DB2
           T1
           T2
               C2  &lt;--  These 2 were sorted correctly
               C1  &lt;--
               C3
  3. Sort again by the Status column - T2 gets collapsed
  Schema
       DB2
           T1
           T2  &lt;-T2 is now collapsed
       DB1</pre>
    </div>

    <div id="c20" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=113675#c20">Comment 20</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Alan Plante</span> <a href="http://wiki.eclipse.org/ECA"><img class="cla_dec" src="https://accounts.eclipse.org/user/eca/badge?mail=aplante&#64;us.ibm.com" alt="CLA" title="Eclipse Contributor Agreement" /></a> <a href="https://eclipse.org/donate/"><img class="cla_dec" src="//www.eclipse.org/donate/web-api/friends_decorator.php?email=aplante&#64;us.ibm.com" alt="Friend" title="Friend of Eclipse" /></a>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2007-11-21 12:39:36 EST
        </span>

      </div>




<pre class="bz_comment_text">(In reply to <a href="show_bug.cgi?id=113675#c11">comment #11</a>)
<span class="quote">&gt;I wrote a test called TreeViewerAdvancedTest in
&gt; org.eclipse.ui.tests that goes to verify that the sorting capability for deep
&gt; trees works (Boris may commit this if he feels its necessary).  The problem was</span >


I'm not seeing this test class in org.eclipse.ui.tests. Is their a particular branch or version that this is in?</pre>
    </div>

    <div id="c21" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=113675#c21">Comment 21</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Boris Bokowski</span> <a href="http://wiki.eclipse.org/ECA"><img class="cla_dec" src="https://accounts.eclipse.org/user/eca/badge?mail=bokowski&#64;google.com" alt="CLA" title="Eclipse Contributor Agreement" /></a> <a href="https://eclipse.org/donate/"><img class="cla_dec" src="//www.eclipse.org/donate/web-api/friends_decorator.php?email=bokowski&#64;google.com" alt="Friend" title="Friend of Eclipse" /></a>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2007-11-21 13:16:33 EST
        </span>

      </div>




<pre class="bz_comment_text">(In reply to <a href="show_bug.cgi?id=113675#c20">comment #20</a>)
<span class="quote">&gt; (In reply to <a href="show_bug.cgi?id=113675#c11">comment #11</a>)
&gt; &gt;I wrote a test called TreeViewerAdvancedTest 
&gt; &gt;...
&gt; I'm not seeing this test class in org.eclipse.ui.tests. Is their a particular
&gt; branch or version that this is in?</span >

No, this test was never contributed. Ashish, if you want to contribute that test it needs to be attached to a bugzilla.</pre>
    </div>

    <div id="c22" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=113675#c22">Comment 22</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Boris Bokowski</span> <a href="http://wiki.eclipse.org/ECA"><img class="cla_dec" src="https://accounts.eclipse.org/user/eca/badge?mail=bokowski&#64;google.com" alt="CLA" title="Eclipse Contributor Agreement" /></a> <a href="https://eclipse.org/donate/"><img class="cla_dec" src="//www.eclipse.org/donate/web-api/friends_decorator.php?email=bokowski&#64;google.com" alt="Friend" title="Friend of Eclipse" /></a>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2008-04-18 17:15:27 EDT
        </span>

      </div>




<pre class="bz_comment_text">*** <a class="bz_bug_link 
          bz_status_RESOLVED  bz_closed"
   title="RESOLVED DUPLICATE - [Viewers] TreeViewer loses expansion state when refresh needs to create new item for existing element"
   href="show_bug.cgi?id=227800">Bug 227800</a> has been marked as a duplicate of this bug. ***</pre>
    </div>

    <div id="c23" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=113675#c23">Comment 23</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Boris Bokowski</span> <a href="http://wiki.eclipse.org/ECA"><img class="cla_dec" src="https://accounts.eclipse.org/user/eca/badge?mail=bokowski&#64;google.com" alt="CLA" title="Eclipse Contributor Agreement" /></a> <a href="https://eclipse.org/donate/"><img class="cla_dec" src="//www.eclipse.org/donate/web-api/friends_decorator.php?email=bokowski&#64;google.com" alt="Friend" title="Friend of Eclipse" /></a>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2008-05-02 14:56:32 EDT
        </span>

      </div>




<pre class="bz_comment_text">Mass update - removing 3.4 target. This was one of the bugs I marked for investigation (and potential fixing) in 3.4 but I ran out of time. Please ping on the bug if fixing it would be really important for 3.4, and does not require API changes or feature work.</pre>
    </div>

    <div id="c24" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=113675#c24">Comment 24</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Farokh Morshed</span> <a href="http://wiki.eclipse.org/ECA"><img class="cla_dec" src="https://accounts.eclipse.org/user/eca/badge?mail=fmorshed&#64;curl.com" alt="CLA" title="Eclipse Contributor Agreement" /></a> <a href="https://eclipse.org/donate/"><img class="cla_dec" src="//www.eclipse.org/donate/web-api/friends_decorator.php?email=fmorshed&#64;curl.com" alt="Friend" title="Friend of Eclipse" /></a>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2009-01-26 12:56:37 EST
        </span>

      </div>




<pre class="bz_comment_text">We have run into this bug and I am not sure if I have a reasonable workaround for it.

We extend org.eclipse.ui.navigator.navigatorContent as part of the common navigation framework and extending the Eclipse project explorer.

When we call the viewer.refresh, sometimes the tree collapses.  Weird, because it does not all the time.

So, I tried to use the workaround suggested in this ticket and put getExpandedElements and setExpandedElements around the viewer.refresh call.  But discovered that this technique does not work.  Our code is told (by another subsystem that we do not control) that a node has changed and this node is the grandparent of the node that has really changed (removed/added).  See example below.  If our code was told to change the parent of the node that has changed then I think this workaround would work.  

For example, when the tree is expanded like this:

A
  B
    C
      x
      y

and x is removed, our code is told that B has changed.  Hence, we refresh B.  This call to viewer.refresh collapses C.  Even if we used the workaround mentioned, we would only save and restore the expansion state of B, not C.

Any ideas on a workaround for this case?  If not, can we have this bug fixed soon?

  </pre>
    </div>

    <div id="c25" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=113675#c25">Comment 25</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Boris Bokowski</span> <a href="http://wiki.eclipse.org/ECA"><img class="cla_dec" src="https://accounts.eclipse.org/user/eca/badge?mail=bokowski&#64;google.com" alt="CLA" title="Eclipse Contributor Agreement" /></a> <a href="https://eclipse.org/donate/"><img class="cla_dec" src="//www.eclipse.org/donate/web-api/friends_decorator.php?email=bokowski&#64;google.com" alt="Friend" title="Friend of Eclipse" /></a>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2009-01-26 13:09:48 EST
        </span>

      </div>




<pre class="bz_comment_text">(In reply to <a href="show_bug.cgi?id=113675#c24">comment #24</a>)
<span class="quote">&gt; ...  Even if we used the workaround
&gt; mentioned, we would only save and restore the expansion state of B, not C.</span >

I don't understand. treeViewer.getExpandedElements() returns all expanded elements, regardless how deep. Similarly, treeViewer.setExpandedElements() will expand all the elements you pass to it. There are cases when setExpandedElements() does not succeed, but these can be avoided by properly implementing the content provider's getParent() method.</pre>
    </div>

    <div id="c26" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=113675#c26">Comment 26</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Boris Bokowski</span> <a href="http://wiki.eclipse.org/ECA"><img class="cla_dec" src="https://accounts.eclipse.org/user/eca/badge?mail=bokowski&#64;google.com" alt="CLA" title="Eclipse Contributor Agreement" /></a> <a href="https://eclipse.org/donate/"><img class="cla_dec" src="//www.eclipse.org/donate/web-api/friends_decorator.php?email=bokowski&#64;google.com" alt="Friend" title="Friend of Eclipse" /></a>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2009-01-26 13:27:12 EST
        </span>

      </div>




<pre class="bz_comment_text">Created <span class=""><a href="attachment.cgi?id=123785&amp;action=diff" name="attach_123785" title="potential solution (untested)">attachment 123785</a> <a href="attachment.cgi?id=123785&amp;action=edit" title="potential solution (untested)">[details]</a></span>
potential solution (untested)

Would something along the lines of this patch help?</pre>
    </div>

    <div id="c27" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=113675#c27">Comment 27</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Farokh Morshed</span> <a href="http://wiki.eclipse.org/ECA"><img class="cla_dec" src="https://accounts.eclipse.org/user/eca/badge?mail=fmorshed&#64;curl.com" alt="CLA" title="Eclipse Contributor Agreement" /></a> <a href="https://eclipse.org/donate/"><img class="cla_dec" src="//www.eclipse.org/donate/web-api/friends_decorator.php?email=fmorshed&#64;curl.com" alt="Friend" title="Friend of Eclipse" /></a>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2009-01-26 14:30:41 EST
        </span>

      </div>




<pre class="bz_comment_text">Ok, I'll subclass AbstractTreeViewer and do what you are suggesting.  Thanks.

Back to my grandparent theory.  I misunderstood the getExpandedElements method
comments.  I take back what I said that the workaround would not work in the
grandparent case.

But, it really did not work for me after I wrapped the refresh call with the
getExpandedElements and setExpandedElements calls.

The problem is the same when I wrapped them or when I do not.  Sometimes it
collapses the tree and sometimes it does not!!  Using the debugger I can
keep stepping through the code that send the events and see it sometimes
collapse and sometimes not.  I set breakpoints in certain code in the
TreeViewer and its parents that I thought would do the collapsing but could
never see when and why it decided to collapse sometimes.  Weird.  What could
cause such a behaviour?
</pre>
    </div>

    <div id="c28" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=113675#c28">Comment 28</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Boris Bokowski</span> <a href="http://wiki.eclipse.org/ECA"><img class="cla_dec" src="https://accounts.eclipse.org/user/eca/badge?mail=bokowski&#64;google.com" alt="CLA" title="Eclipse Contributor Agreement" /></a> <a href="https://eclipse.org/donate/"><img class="cla_dec" src="//www.eclipse.org/donate/web-api/friends_decorator.php?email=bokowski&#64;google.com" alt="Friend" title="Friend of Eclipse" /></a>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2009-01-26 15:10:18 EST
        </span>

      </div>




<pre class="bz_comment_text">(In reply to <a href="show_bug.cgi?id=113675#c27">comment #27</a>)
<span class="quote">&gt; What could cause such a behaviour?</span >

Check your implementation of ITreeContentProvider.getParent() (and the implementation of getParent() for all other participating tree content providers, in the Common Navigator case).
</pre>
    </div>

    <div id="c29" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=113675#c29">Comment 29</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Boris Bokowski</span> <a href="http://wiki.eclipse.org/ECA"><img class="cla_dec" src="https://accounts.eclipse.org/user/eca/badge?mail=bokowski&#64;google.com" alt="CLA" title="Eclipse Contributor Agreement" /></a> <a href="https://eclipse.org/donate/"><img class="cla_dec" src="//www.eclipse.org/donate/web-api/friends_decorator.php?email=bokowski&#64;google.com" alt="Friend" title="Friend of Eclipse" /></a>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2009-11-26 09:50:01 EST
        </span>

      </div>




<pre class="bz_comment_text">Hitesh is now responsible for watching bugs in the [Viewers] component area.</pre>
    </div>

    <div id="c30" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=113675#c30">Comment 30</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Dirk Baumann</span> <a href="http://wiki.eclipse.org/ECA"><img class="cla_dec" src="https://accounts.eclipse.org/user/eca/badge?mail=dbaumann&#64;csc.com" alt="CLA" title="Eclipse Contributor Agreement" /></a> <a href="https://eclipse.org/donate/"><img class="cla_dec" src="//www.eclipse.org/donate/web-api/friends_decorator.php?email=dbaumann&#64;csc.com" alt="Friend" title="Friend of Eclipse" /></a>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2010-04-09 06:21:23 EDT
        </span>

      </div>




<pre class="bz_comment_text">Created <span class=""><a href="attachment.cgi?id=164351" name="attach_164351" title="Simple snippet to reproduce the tree viewer bug">attachment 164351</a> <a href="attachment.cgi?id=164351&amp;action=edit" title="Simple snippet to reproduce the tree viewer bug">[details]</a></span>
Simple snippet to reproduce the tree viewer bug 

This is a simple snippet to reproduce the bug. It creates a tree viewer with sample expanded content. When pressing a key an item is added and a different item in the tree collapses when the tree is refreshed. Note that the item stays expanded when the new item is added at the end of the items (see comment in code). I hope this example is useful.</pre>
    </div>

    <div id="c31" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=113675#c31">Comment 31</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Adria Ciute</span> <a href="http://wiki.eclipse.org/ECA"><img class="cla_dec" src="https://accounts.eclipse.org/user/eca/badge?mail=adrijukas&#64;yahoo.com" alt="CLA" title="Eclipse Contributor Agreement" /></a> <a href="https://eclipse.org/donate/"><img class="cla_dec" src="//www.eclipse.org/donate/web-api/friends_decorator.php?email=adrijukas&#64;yahoo.com" alt="Friend" title="Friend of Eclipse" /></a>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2016-05-11 05:21:02 EDT
        </span>

      </div>




<pre class="bz_comment_text">I am getting exactly the same problem described by the <a href="show_bug.cgi?id=113675#c30">comment 30</a>. When a tree has fully expanded node, and a new node gets added above it, after refresh this expanded node is collapsed. A node remains expanded if the new node appears below it.

I am using Eclipse 4.5

When debugging a working refresh scenario AbstractTreeViewer#updateChildren() successfully finds all the items for a top node, i.e getChildren() returns the number of items as expected.

In a non working case, the above call only returns 1 child. When digging deeper, it turned out that in Tree#getItems() only loops the following code once

while (hItem != 0) {
  hItem = OS.SendMessage (handle, OS.TVM_GETNEXTITEM, OS.TVGN_NEXT, hItem);
  count++;
}

It's all OS related code, so I've no clue what goes on, but after the first loop, hItem becomes 0 and only one TreeItem gets returned.

Any workaround?</pre>
    </div>

    <div id="c32" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=113675#c32">Comment 32</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">badii bayoudh</span> <a href="http://wiki.eclipse.org/ECA"><img class="cla_dec" src="https://accounts.eclipse.org/user/eca/badge?mail=badii.bayoudh&#64;gmail.com" alt="CLA" title="Eclipse Contributor Agreement" /></a> <a href="https://eclipse.org/donate/"><img class="cla_dec" src="//www.eclipse.org/donate/web-api/friends_decorator.php?email=badii.bayoudh&#64;gmail.com" alt="Friend" title="Friend of Eclipse" /></a>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2017-04-10 05:54:33 EDT
        </span>

      </div>




<pre class="bz_comment_text">I am getting exactly the same problem described by the <a href="show_bug.cgi?id=113675#c31">comment 31</a>. When a tree has fully expanded node, and a new node gets added above it, after refresh this expanded node is collapsed. A node remains expanded if the new node appears below it.

I am using Eclipse 4.6.1.

Has someone a workaroud for it?</pre>
    </div>

    <div id="c33" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=113675#c33">Comment 33</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">badii bayoudh</span> <a href="http://wiki.eclipse.org/ECA"><img class="cla_dec" src="https://accounts.eclipse.org/user/eca/badge?mail=badii.bayoudh&#64;gmail.com" alt="CLA" title="Eclipse Contributor Agreement" /></a> <a href="https://eclipse.org/donate/"><img class="cla_dec" src="//www.eclipse.org/donate/web-api/friends_decorator.php?email=badii.bayoudh&#64;gmail.com" alt="Friend" title="Friend of Eclipse" /></a>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2017-04-11 07:39:44 EDT
        </span>

      </div>




<pre class="bz_comment_text">I tried the Workaround proposed by Boris. It works fine. But with big structures I have a performance Problem. I am playing with structures, which have more than 30.000 items. With such structures the execution of setExpandMethod can dauer more than 5 seconds. 

A refresh which dauer 6s instead of 1s is not really good :-( 

Has anyone a better idea?</pre>
    </div>

    <div id="c34" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=113675#c34">Comment 34</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Christian Walther</span> <a href="http://wiki.eclipse.org/ECA"><img class="cla_dec" src="https://accounts.eclipse.org/user/eca/badge?mail=walther&#64;indel.ch" alt="CLA" title="Eclipse Contributor Agreement" /></a> <a href="https://eclipse.org/donate/"><img class="cla_dec" src="//www.eclipse.org/donate/web-api/friends_decorator.php?email=walther&#64;indel.ch" alt="Friend" title="Friend of Eclipse" /></a>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2018-03-15 06:31:17 EDT
        </span>

      </div>




<pre class="bz_comment_text">I am running into this problem in the Project Explorer when CDT’s “Searching for Binaries” job completes and adds the “Binaries” entry at the top of a project, and it’s very annoying.

I have a simple patch to Snippet002TreeViewer.java that demonstrates the problem, but I think there’s no need for that anymore as Dirk’s snippet does the same.

Boris’ patch still applies in R4_7_maintenance and solves the Project Explorer issue for me. Should I push it to Gerrit?</pre>
    </div>

    <div id="c35" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=113675#c35">Comment 35</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Eclipse Genie</span> <a href="http://wiki.eclipse.org/ECA"><img class="cla_dec" src="https://accounts.eclipse.org/user/eca/badge?mail=genie&#64;eclipse.org" alt="CLA" title="Eclipse Contributor Agreement" /></a> <a href="https://eclipse.org/donate/"><img class="cla_dec" src="//www.eclipse.org/donate/web-api/friends_decorator.php?email=genie&#64;eclipse.org" alt="Friend" title="Friend of Eclipse" /></a>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2020-07-23 19:15:34 EDT
        </span>

      </div>




<pre class="bz_comment_text">This bug hasn't had any activity in quite some time. Maybe the problem got resolved, was a duplicate of something else, or became less pressing for some reason - or maybe it's still relevant but just hasn't been looked at yet. As such, we're closing this bug.

If you have further information on the current state of the bug, please add it and reopen this bug. The information can be, for example, that the problem still occurs, that you still want the feature, that more information is needed, or that the bug is (for whatever reason) no longer relevant.

--
The automated Eclipse Genie.</pre>
    </div>


  

</td>
<td>
</td>
</tr></table>
  </div>
        

</form>

<hr>
<ul class="related_actions">
    <li><a href="show_bug.cgi?format=multiple&amp;id=113675">Format For Printing</a></li>
    <li>&nbsp;-&nbsp;<a href="show_bug.cgi?ctype=xml&amp;id=113675">XML</a></li>
    <li>&nbsp;-&nbsp;<a href="enter_bug.cgi?cloned_bug_id=113675">Clone This Bug</a></li>
    
    <li>&nbsp;-&nbsp;<a href="#">Top of page </a></li>
    </ul>

<br>
</div>

    <div id="footer">
      <div class="intro"></div>
<ul id="useful-links">
  <li id="links-actions"><ul class="links">
  <li><a href="./">Home</a></li>
  <li><span class="separator">| </span><a href="enter_bug.cgi">New</a></li>
  <li><span class="separator">| </span><a href="describecomponents.cgi">Browse</a></li>
  <li><span class="separator">| </span><a href="query.cgi">Search</a></li>

  <li class="form">
    <span class="separator">| </span>
    <form action="buglist.cgi" method="get"
        onsubmit="if (this.quicksearch.value == '')
                  { alert('Please enter one or more search terms first.');
                    return false; } return true;">
    <input type="hidden" id="no_redirect_bottom" name="no_redirect" value="0">
    <script type="text/javascript">
      if (history && history.replaceState) {
        var no_redirect = document.getElementById("no_redirect_bottom");
        no_redirect.value = 1;
      }
    </script>
    <input class="txt" type="text" id="quicksearch_bottom" name="quicksearch" 
           title="Quick Search" value="">
    <input class="btn" type="submit" value="Search" 
           id="find_bottom"></form>
  <a href="page.cgi?id=quicksearch.html" title="Quicksearch Help">[?]</a></li>

  <li><span class="separator">| </span><a href="report.cgi">Reports</a></li>

  <li>
      <span class="separator">| </span>
        <a href="request.cgi">Requests</a></li>


  <li>
        <span class="separator">| </span>
        <a href="https://bugzilla.readthedocs.org/en/5.0/using/understanding.html" target="_blank">Help</a>
      </li>
    

    <li id="mini_login_container_bottom">
  <span class="separator">| </span>
  <a id="login_link_bottom" href="show_bug.cgi?id=113675&amp;GoAheadAndLogIn=1"
     onclick="return show_mini_login_form('_bottom')">Log In</a>

  <form action="show_bug.cgi?id=113675" method="POST"
        class="mini_login bz_default_hidden"
        id="mini_login_bottom">
    <input id="Bugzilla_login_bottom" required
           name="Bugzilla_login" class="bz_login"
        placeholder="Login">
    <input class="bz_password" name="Bugzilla_password" type="password"
           id="Bugzilla_password_bottom" required
           placeholder="Password">
    <input type="hidden" name="Bugzilla_login_token"
           value="">
    <input type="submit" name="GoAheadAndLogIn" value="Log in"
            id="log_in_bottom">
    <a href="#" onclick="return hide_mini_login_form('_bottom')">[x]</a>
  </form>
</li>
  <span class="separator">| </span>
  <li><a href="http://www.eclipse.org/legal/termsofuse.php">Terms of Use</a></li>
  <span class="separator">| </span>
  <li><a href="http://www.eclipse.org/legal/copyright.php">Copyright Agent</a></li>
</ul>
  </li>

  




  
</ul>

      <div class="outro"></div>
    </div>

  </body>
</html>